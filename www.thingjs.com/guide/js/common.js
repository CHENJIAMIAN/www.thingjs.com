var menudic = {
    'main': './html/mainNew2.html', //0
    'platform': './html/platformNew.html',
    'tutorial': './html/tutorial.html',
    'sample': './html/sample_test.html',
    'help': './html/help.html',
    'price': './html/priceNewThree.html',
    'zeroCodePrice': './html/priceNew1.html',
    'store': './html/store.html',
    'store2': './html/store2.html',
    'storeD': './html/storeDetails.html',
    'campus': './html/campus2.html',
    'city': './html/newCity2.html',
    'chart': './html/chart.html',
    'pano': './html/pano.html',
    'speedcity': './html/speedcity.html',
    'speedcityshow': './html/speedcityshow.html',
    'speedCityDetailPages': './html/speedCityDetailPages.html',
    'mod': './html/modNew.html',
    'safety': './html/safety.html',
    'building': './html/building.html',
    'fire': './html/fire.html',
    'archive': './html/archive.html',
    'granary': './html/granary.html',
    'port': './html/port.html',
    'aboutUs': './html/aboutUs.html',
    'course': './html/courseIframe.html',
    'partners': './html/partners.html',
    'particle': './html/particle.html',
    'signupentry': './html/signUpEntry/signUpEntry.html',
    'wisdomScenarioVDC': './html/wisdomScenarioVDC/wisdomScenarioVDC.html',
    'builderPro': './html/builderPro.html',
    'thingjsvideo': './html/thingjsvideo.html',
    'ex':'./html/ex.html',
	'modelDetail':'./html/modelDetail.html',
    'imagination2021': './html/imagination2021/imagination2021.html',
    'city2': './html/city_2.html',
    // 'topoBuilder':'./html/topoBuilder.html',
    'topoBuilder':'./html/topo2.html',
    'liveServer':'./html/liveServer.html',
    'dix':'./html/newDix.html',
    'chartBuilder':'./html/chart2.html',
    // 'intelligentCampus':'./html/intelligentCampus.html',
    'intelligentMine':'./html/intelligentMine.html',
    'digitalPowerGrid':'./html/digitalPowerGrid.html',
    'intelligentSchool':'./html/smartCampus.html',
    'intelligentHospital':'./html/intelligentHospital.html',
    'intelligentCommunity':'./html/intelligentCommunity.html',
    // 'offline':'./html/offline.html',
    // 'offline_SDK':'./html/offline_SDK.html',
    // 'loadingForPass':'./html/loadingForPaas.html',
    // 'onlineDeployment':'./html/onlineDeployment.html',
    // 'offlineDeployment':'./html/offlineDeployment.html',
    // 'online_VIP':'./html/online_VIP.html',
	'courseDetails':'./html/signUpEntry/courseDetails.html',
    'courseDetailTiming':'./html/signUpEntry/courseDetailTiming.html',
    "plugin":"./html/newPlugin.html",
    'studio':'./html/studio.html',
    'schoolScenesCompetetion':'./html/schoolScenesCompetetion/schoolScenesCompetetion.html',
    'voteForScenes':'./html/schoolScenesCompetetion/voteForScenes.html',
    'thingclub':'./html/thingclub.html',
    'showroom':'./html/showroom.html',
    // 'newShowroom':'./html/newShowroom.html', // 暂时不上线
    'thingland':'./html/thingland.html',
    'bim':'./html/newBim.html',
    'curriculum':'./html/curriculum.html',
    '404':'./html/notFound.html',
    'courseDetailTwinTiming':'./html/signUpEntry/courseDetailTwinTiming.html',
    'courseNew':'./html/signUpEntry/courseNew1.html',
    'courseModel':'./html/signUpEntry/courseModel.html',
    // 'intelligentCity2':'./html/smartCity.html',
    // 'intelligentTraffic2':'./html/smartTraffic.html',
    // 'intelligentBuilding':'./html/smartBuilding.html',
    'IOT_Exhibition':'./html/IOT_Exhibition.html',
    'digitalTwin':'./html/digitalTwin.html',
    // 'smartFactory':'./html/smartFactory.html',
    // 'smartCampus':'./html/smartCampus.html',
    'quickDT':'./html/quickDT.html',
    'chartBuilder2':'./html/chartBuilder2.html',
    'topoBuilder2':'./html/topoBuilder2.html',
    'template':'./html/template.html',
    'api':'./html/notebook.html',
    'esign':'./html/esign.html',
    'esignList':'./html/esignList.html',
    'customizedService': './html/customizedService.html',
    'intelligentPower':'./html/intelligentPower.html',
    'intelligentCity':'./html/newSmartCity.html',
    'intelligentTraffic':'./html/newSmartTraffic.html',
    'intelligentSchool':'./html/newSmartSchool.html',
    'intelligentCampus':'./html/intelligentPart.html',
    'intelligentFactory':'./html/intellFactory.html',
    'online_VIP':'./html/thingjs_vip.html',
    'onlineDeployment':'./html/onlineDeployment2.html',
    'offline_SDK':'./html/offline_SDK2.html',
    'offline':'./html/offline2.html',
    'offlineDeployment':'./html/offlineDeployment2.html',
    'service':'./html/service.html',
    'dcv':'./html/motorRoom.html',
    'wx_userinfo':'./html/wx_userinfo.html',
    'development':'./html/development.html',
    'modeling':'./html/modeling.html',
    'support':'./html/support.html',
    'training': './html/training.html'
};
var menutitle = {
    'main': 'ThingJS - 物联网3D可视化开发平台 - 数字孪生可视化平台', //0
    'platform': 'ThingJS平台 - 面向物联网的3D可视化开发平台，快速开发数字孪生可视化应用 - ThingJS',
    'tutorial': 'ThingJS - 物联网3D可视化开发平台',
    'sample': 'ThingJS - 在线开发',
    'help': 'ThingJS - 物联网3D可视化开发平台',
    'price': '产品和服务 - ThingJS',
    'store': 'ThingJS应用商店，专业数字孪生项目开发软件商店 - ThingJS',
    'storeD': 'ThingJS - 物联网3D可视化开发平台',
    'campus': 'CampusBuilder - 简单好用的3D场景搭建工具，0基础制作三维场景 - ThingJS',
    'city': 'CityBuilder - 聚焦城市的三维地图搭建工具，快速生成3D城市模型 - ThingJS',
    'chart': 'ThingJS - ChartBuilder',
    'pano': 'ThingJS - ThingPano',
    'speedcity': '三维智慧城市应用 快速应用智慧3D城市 - ThingJS',
    'speedcityshow': '一键城市2.0 - 快速生成3D地图三维地图模型',
    'mod': 'ThingDepot - 专业3D模型网站，拥有上万种3D模型，涵盖数十个行业 - ThingJS',
    'safety': 'ThingJS - 安防管理',
    'building': 'ThingJS - 智慧建筑',
    'fire': 'ThingJS - 智慧消防',
    'archive': 'ThingJS - 档案管理',
    'granary': 'ThingJS - 智慧仓储',
    'port': 'ThingJS - 数字港口',
    'aboutUs': 'ThingJS - 关于我们',
    'course': 'ThingJS - 物联网3D可视化开发平台',
    'partners': 'ThingJS - 合作伙伴',
    'wisdomScenarioVDC': '数字孪生智慧场景开发大赛 - ThingJS',
    'thingjsvideo': 'ThingJS教程（2020版） - ThingJS',
    'builderPro': 'BuilderPro - 更专业的3D地图场景搭建工具，在线编辑更多彩的三维地图 - ThingJS',
    'imagination2021': 'Imagination 2021 ThingJS开发者大会',
    'topoBuilder':'TopoBuilder - 2D拓扑图绘制',
    'dix':'DIX - 高效、强大的数据集成工具',
    'chartBuilder':'ChartBuilder - 2D图表搭建',
    'liveServer':'ThingJS LiveServer - 视频流服务',
    'intelligentCampus':'智慧园区 - 智慧园区可视化',
    'intelligentMine':'智慧矿山 - 智慧矿山可视化',
    'digitalPowerGrid':'数字电网 - 数字电网可视化',
    'intelligentSchool':'智慧校园 - 智慧校园可视化',
    'intelligentHospital':'智慧医院 - 智慧医院可视化',
    'intelligentFactory':'智慧工厂 - 智慧工厂可视化',
    'intelligentCommunity':'智慧社区 - 智慧社区可视化',
    'intelligentCity':'智慧城市 - 智慧城市可视化',
    'intelligentTraffic':'智慧交通 - 智慧交通可视化',
    'intelligentBuilding':'智慧楼宇 - 智慧楼宇可视化',
    'offline':'ThingJS离线开发网络版 - 多人协作,高效开发数字孪生可视化应用',
    'offline_SDK':'离线开发SDK-开发离线环境、加密安全',
    'onlineDeployment':'在线部署-商用授权、快速部署可视化项目',
    'offlineDeployment':'离线部署-永久授权、项目保密',
    'online_VIP':'在线开发VIP-更多功能、更高效率的开发数字孪生可视化项目',
    'plugin':'森插件 3DsMAX丨森插件一个软件完成所有模型设计工序，3dmax插件-ThingJS平台',
    'studio':'森工厂ThingStudio丨森工厂，一站式数字孪生开发平台 ',
    'signupentry': 'IOT可视化开发师认证 - 中关村物联网数字孪生技术学院 x 北京优锘科技联合认证 - ThingJS物联网3D可视化开发平台 - 数字孪生可视化平台',
    'courseDetails':'IOT可视化开发师认证 - 中关村物联网数字孪生技术学院 x 北京优锘科技联合认证 - ThingJS物联网3D可视化开发平台 - 数字孪生可视化平台',
    'courseDetailTiming':'IOT可视化开发师认证 - 中关村物联网数字孪生技术学院 x 北京优锘科技联合认证 - ThingJS物联网3D可视化开发平台 - 数字孪生可视化平台',
    'thingclub':'物联森友会丨来物联森友会 共创物联产业元宇宙 - ThingJS',
    'showroom':'森展厅丨零代码搭建虚拟展厅 - ThingJS',
    'thingland':'森大陆丨森大陆与物联企业，共创元宇宙产业版图 - ThingJS',
    'bim':'森BIM插件丨BIM秒变轻量化 低零代码兼容 - ThingJS',
    'courseNew':'ThingJS开发训练营_数字孪生开发课程_数字孪生在线课程 - ThingJS物联网3D可视化开发平台',
    'courseModel':'数字孪生建模师训练营 - ThingJS数字孪生低代码开发平台',
    'IOT_Exhibition':'ThingJS数字孪生低代码开发平台｜ThingJS亮相2022深圳物联网展会',
    'digitalTwin':'数字孪生教育实训平台_数字孪生教育行业方案_数字孪生教学平台_ThingJS数字孪生开发平台',
    'quickDT':'QuickDT-数字孪生快人一步-数字孪生应用快速生成工具（ThingJS低代码开发平台专属）',
    'chartBuilder2':'森大屏ChartBuilder丨零代码拖拽组装数据可视化大屏',
    'topoBuilder2':'森拓扑TopoBuilder丨专业的Web组态绘制工具',
    'template':'效果模板-数字孪生场景风格自由切换-科幻风格场景快速生成工具',
    'intelligentPower':'ThingJS智慧电力行业模板-快速无痛将电力管理提升至3D阶段-开箱即用，提升90%开发效率',
    'customizedService':'森拓扑TopoBuilder - 零代码web组态开发工具',
    'dcv':'ThingJS-DCV面向机房管理的专业平台',
    'development': '森服务-开发服务',
    'modeling':'森服务-建模服务',
    'support':'森服务-支持服务',
    'training': '森服务-培训服务'
};
var menuKeywords = {
    'main': '物联网,三维,可视化,数字孪生,数字孪生城市,智慧城市,智慧校园,智慧社区,智慧生活,智慧园区解决方案,智慧党建,智慧交通,智慧水务,智慧医院',
    'platform': '数字孪生,物联网,三维,可视化,数字孪生,数字孪生城市,智慧城市,智慧园区,3D建模,3D场景,三维场景',
    'campus': '数字孪生,三维场景,3D场景,物联网,智慧社区,智慧校园,智慧园区,智慧生活,智慧党建,智慧医院,智慧水务,智慧楼宇,智慧安防',
    'price':'ThingJS,物联网,数字孪生,开发者,部署,建模,开发服务,套餐组合',
    'city': '数字孪生城市,三维地图,3D地图,3D城市,智慧城市,智慧农业,能源管理,公安应用,智慧交通,geojson',
    'mod': '3D模型,模型网站,3D建模,3D人物模型,3D人体模型,3D场景,3D城市,数字孪生',
    'store': '应用商店,软件商店,三维,可视化,数字孪生,3D城市,城市模型,物联网',
    'speedcity': 'ThingJS三维智慧城市应用原生支持智慧社区、智慧交通、智慧安防、智慧消防、智慧教育、智慧医疗等10余个行业。交互好、图表全、特效丰富，仅需数据对接即可部署应用。',
    'speedcityshow': '3d地图,3d立体地图,3d全景地图,三维地图,三维立体地图,三维全景地图,城市沙盘3d模型,城市三维实景地图,三维数字城市,三维城市模型,立体城市,三维虚拟城市,三维立体城市,城市三维建模,三维仿真城市',
    'signupentry': 'IOT、可视化认证、可视化开发师、数字孪生认证',
    'wisdomScenarioVDC': '数字孪生,开发者大赛,3D场景,优锘科技,ThingJS,智慧园区,智慧城市,智慧楼宇',
    'imagination2021': 'UINO,优锘科技,ThingJS,数字孪生,数字孪生可视化,开发者大会',
    'topoBuilder':'图表制作工具、流程图绘制、在线图表、图表生成、图表绘制工具、专业绘制图表、流程图图表、可视化图表、企业报表、数据可视化、统计图表',
    'liveServer':'视频在线转换、视频转格式、免费视频转换、视频转码、实时视频流转换、视频流协议、视频转换、视频数据转换',
    'dix':'数据采集、数据集成、数据整合、数据集成平台、数据库集成、异构数据集成、大数据集成、数据整合方法、什么是数据集成、多源异构数据集成、多数据整合',
    'chartBuilder':'可视化数据、数据图表、可视化数据分析图表、数据可视化分析、图表数据分析、可视化工具、可视化报表、可视化数据图表、数据可视化应用、数据报表可视化、数据可视化、数据可视化工具、可视化图表、数据可视化图表',
    'intelligentCampus':'智慧园区综合管理平台、智慧园区解决方案、智慧园区管理系统、智慧园区平台、智慧工业园区、智慧产业园区、智能园区、智慧园区管理、园区智能化、智慧园区定义、智慧园区功能',
    'intelligentMine':'智慧矿山定义、3d智慧矿山、智慧化煤矿、3d智慧矿山、智慧矿山解决方案、数字矿山、智慧矿山建设标准、智慧矿山管理系统、智慧矿井、智慧矿山开发、智慧矿山沙盘、数字化智慧矿山',
    'digitalPowerGrid':'数字电网概念、数字化电网、电力可视化、电网可视化、电网数据可视化、配电网可视化、电网三维可视化、数字电网功能、数字电网解决方案',
    'intelligentTraffic':'轨道交通、智慧地铁、智慧港口、智慧船运、智慧货运、智慧城市、智慧公交、城市公交可视化、城市轨道可视化、智慧机场、智慧水路、智慧交运、智慧物流、智慧交管、综合交通应急指挥系统、智慧交通设施可视化、智慧停车场、智慧陆运、智慧公交、公交运行监测可视化、公交运行监控系统、区域交通可视化、交通智慧云图、交通可视化大屏',
    'intelligentBuilding':'智慧楼宇、楼宇可视化、楼宇数字孪生、楼宇消防、楼宇监控、大楼消防预警、大楼监控、楼宇可视化方案、楼宇门禁系统、智慧楼宇能源运营系统、智慧楼宇停车管理系统、智慧建筑综合管理平台、智慧楼控、楼宇照明系统、楼宇消防、智慧楼宇可视化大屏',
    'intelligentSchool':'智慧校园管理平台、智慧校园管理系统、智慧校园建设方案、智慧校园建设、数字化校园、智慧校园综合管理系统、数字化智慧校园、智慧校园综合平台、智慧校园门禁系统、什么是智慧校园、智慧校园综合解决方案、数字化校园建设、虚拟校园、智慧校园安防、智慧课堂',
    'intelligentHospital':'智慧医保、智慧医院系统、智慧医院建设、智慧医院平台、医院智慧管理、智慧医院解决方案、什么是智慧医院、智慧医院管理、智慧医院的概念、智慧医院分诊系统、智慧医院方案、智慧门诊、医院智慧门诊、智慧化医院建设',
    'intelligentFactory':'仓库可视化管理、工厂自动化、车间可视化管理、流程可视化、生产现场可视化管理、3d工厂可视化、数字化工厂、智慧工厂解决方案、智慧工厂系统、虚拟工厂、工厂智能化、数字化智能工厂、智慧工厂管理系统、工厂数字化、工业4.0智慧工厂、智慧厂房、智慧工厂智能生产、智慧工厂运营、智慧工厂生产流程',
    'intelligentCommunity':'智慧小区、智慧社区解决方案、智慧社区管理平台、智慧社区建设、智慧社区综合服务平台、物业智慧社区、智慧社区功能、智慧社区案例、绿色智慧社区、街道智慧社区、智慧生态社区、智慧社区物业、专业智慧社区平台、社区沙盘、社区安防可视化、社区能源管理可视化',
    'intelligentCity':'智慧城市解决方案、智慧城市概念、智慧城市可视化、智慧城市管理平台、智慧城市建设、智慧城市模型、智慧建筑与智慧城市、智慧城镇、物联网智慧城市、智慧城市沙盘、智慧城市可视化方案、3d智慧城市、智慧城市沙盘模型、绿色智慧城市、智慧城市信息化建设、智慧城市一张图、智慧城市与智慧水务',
    'offline':'数字孪生开发,三维可视化开发,3D可视化开发,离线开发,团队协作',
    'offline_SDK':'开发授权、开发环境、专属授权、开发模式、sdk开发',
    'onlineDeployment':'在线部署、公有云部署、自动化部署、云服务器部署',
    'offlineDeployment':'本地部署、环境隔离、自有服务器部署、永久授权',
    'online_VIP':'开发平台、在线开发、自主开发、快速开发、多人开发、临时部署、源码支持、专属源码',
    'plugin':'模型场景制作，3dmax插件，3D模型烘培，3D模型动画，3D模型特效，创建三维模型，提高模型制作效率，3D模型设计',
    'studio':'森工厂，森工厂thingstudio，数字孪生开发平台，数字孪生工具，数字孪生零代码，数字孪生免费，优锘森工厂',
    'courseDetails':'IOT、可视化认证、可视化开发师、数字孪生认证',
    'courseDetailTiming':'IOT、可视化认证、可视化开发师、数字孪生认证',
    'thingclub':'物联森友会，优锘森友会，物联网森友会',
    'showroom':'森展厅，虚拟展厅，元宇宙展厅',
    'thingland':'物联森友会，森大陆',
    'bim':'森BIM，BIM插件，森BIM插件',
    'courseNew':'数字孪生课程，数字孪生开发课程，thingjs课程，thingjs在线开发课程',
    'courseModel':'ThingJS,森工厂,数字孪生,建模,培训,3D模型,3D场景',
    'IOT_Exhibition':'ThingJS,优锘科技,数字孪生,数字孪生城市,Threejs,模模搭,3D仿真,物联网仿真,数据中心可视化,3D机房,消防可视化,智能建筑,智慧粮仓可视化,智慧工厂可视化,地铁可视化,智慧监狱,智慧城市,智慧园区,安防系统可视化',
    'digitalTwin':'数字孪生教育，数字孪生培训平台，数字孪生培训，数字孪生教学，数字孪生教学平台',
    'quickDT':'数字孪生，零门槛，可视化，无代码，免培训，快速开发，POC项目，场景交互，项目需求对接',
    'chartBuilder2':'可视化大屏制作，可视化大屏UI，数据可视化工具，可视化图表制作，实时场景数据，可视化图标',
    'topoBuilder2':'森拓扑TopoBuilder，2D拓扑图绘制，在线绘图工具，综合绘图工具，组态图绘制，电力图绘制，流程图绘制，UML绘制',
	'template':'效果模板、场景风格、酷炫效果、快速生成、自主设计、低代码',
    'intelligentPower':'电力管理，智慧电力，配电，源网荷储，分布式光伏，新能源，可视化，数字孪生',
    'customizedService':'组态定制，web组态定制,拓扑图定制，组态设计，组态定制设计，web组态定制设计',
    'dcv':'智慧机房、智慧数据中心、机房管理、数据中心可视化、机房可视化、DCV、数字孪生机房、数字孪生数据中心',
    'development': '森服务、开发服务、框架代码、插件开发、DEMO配置规划',
    'modeling':'森服务、建模服务、3D建模服务、3D模型优化服务、3D城市模型、倾斜摄影处理服务',
    'support':'森服务、支持服务、技术指导',
    'training': '森服务、培训服务、ThingJS开发培训、数字孪生建模培训、零代码产品培训'
};
var menuDescription = {
    'main': 'ThingJS物联网三维可视化开发平台，拥有自主研发数字孪生技术，用户借助平台已开发智慧城市、智慧社区、智慧校园、智慧园区、智慧党建、智慧农业、能源管理、公安应用、智慧交通等多种三维可视化解决方案。',
    'platform': 'ThingJS物联网三维可视化开发平台旗下开发工具，遵循WebGL协议，基于JavaScript技术开发。可在3D建模场景基础上，开发智慧城市、智慧园区类型数字孪生项目应用。',
    'campus': 'ThingJS物联网三维可视化开发平台旗下园区级3D场景搭建工具，可快速搭建物联3D场景，用于开发智慧社区、智慧校园、智慧园区等数字孪生可视化解决方案。',
    'price':'ThingJS平台提供包含商业开发者授权、部署授权、建模服务、开发服务在内的多种授权和服务，可根据具体数字孪生业务需要自由搭配套餐组合。',
    'city': 'ThingJS物联网三维可视化开发平台旗下城市级3D场景搭建工具，可快速生成三维地图，用于开发数字孪生城市、智慧城市、智慧农业、能源管理、公安应用、智慧交通等三维可视化解决方案。',
    'mod': 'ThingDepot是ThingJS旗下3D模型网站，面向3D建模师，提供上万种3D模型，可用于CampusBuilder、CityBuilder中轻松搭建数字孪生三维场景。',
    'store': 'ThingJS应用商店，专业数字孪生项目开发软件商店，为客户提供应有尽有的三维可视化开发软件。',
    'speedcity': '智慧城市,3D城市,三维城市,数字城市,智慧城市疫情,智慧城市方案,智慧交通,智慧安防,智慧社区,智慧商业,智慧能源,智慧旅游,数字孪生城市,数字孪生城市案例,数字孪生城市应用',
    'speedcityshow': '一键城市2.0是在线3D地图模型快速生成系统，通过查找选择自己所需城市区域，快速生成三维地图模型场景，可用于构建智慧城市类数字孪生可视化应用。',
    'signupentry': '中关村物联网数字孪生技术学院 由中关村物联网联盟发起，联合北京优锘科技股份有限公司共同成立，数字孪生技术学院将通过Thingjs-X培训平台为核心，面向数字技术领域，全面培养行业专业人才；推出国内首个物联网数字孪生技术开发师职业团体标准，可快速突破技术壁垒，在数字产业化下学习数字孪生技术人员能快速学习掌握技术，实现就业，为智慧城市、数字城市、数字企业提供技术人才；此次发布的数字孪生技术开发师分为初级、中级、高级不同能力的认定，经过培训、考试合格后颁发不同级别的能力证书。',
    'wisdomScenarioVDC': '优锘科技ThingJS数字孪生场景开发大赛，在中国工业互联网研究院 、中关村物联网联盟指导下开展。活动主要面向物联网行业从业者及爱好者，提交3D场景作品即可参加活动评选。',
    'imagination2021': '想象力比认知更重要！这个时代，数字化正在重塑一切；数字化转型成功与否，可以决定一个组织的生死。数字孪生可视化是数字化转型企业必备的全景视图，而开发者，亦是建设者。ThingJS平台致力于帮助开发者低门槛、高效率的开发数字孪生应用。邀请大家，和ThingJS一起，共建未来！',
    'topoBuilder':'简单易用、轻量便捷的高质量综合绘图工具，支持多种专业图形绘制，配合便捷工具栏快速排版。支持多格式文件导入导出，多人实时在线协作并实时存储，随时随地高效协作。',
    'liveServer':'LiveServer提供 GB/T28181 或 RTSP 协议的视频流转换为 H5 视频流的功能，通过对服务器进行相应配置，可轻松实现项目中视频流顺利播放。',
    'dix':'DIX拥有强大的数据处理能力，内置主流集成插件，提升数据集成效率。适配常见集成协议，支持多种数据格式，解决多源异构问题。',
    'chartBuilder':'简单好用的可视化图表制作工具，提供丰富的图表样式及模板可自由配置和布局，全程图形化编辑操作，快速生成专业的可视化图表。',
    'intelligentCampus':'智慧园区资源合集集合了数字孪生智慧园区的案例、工具教程和资源。用户使用合集资源可以快速上手ThingJS，打造自己的智慧园区数字孪生项目。利用ThingJS平台对园区、楼宇建筑结构及设备位置进行真实展现，并可以集成能耗指标、设备状态参数、楼控系统、监控系统等各项数据信息，进行可视化综合监控预警，帮助用户构建专属智慧园区应用。',
    'intelligentMine':'以数字孪生为核心、数据整合为基础，基于统一的数字空间，形成全流程贯通、全业务融合、全场景监控的智慧矿山可视化操作系统，实现对运行态势的实时掌控及运营管理。',
    'digitalPowerGrid':'通过数字孪生可视化技术，与电网企业业务、管理深度融合，不断提高数字化、网络化、智能化水平，形成的新型能源生态系统，帮助电网行业全局视角掌握电网业务管理运营。',
    'intelligentSchool':'从 “智慧管理”“智慧服务”维度，打造校园运营管理综合平台，展示园区、楼宇、设备、管路和环境监测等各类实时信息，实现校园环境宏观尽在掌握，微观逐层缩放的可视化呈现。',
    'intelligentHospital':'以数字孪生为理念，助力医院实现信息聚合、数字建模，三维映射，搭建智能化数字空间，提升医院运营管理效率，打造医院智慧运营新模式。',
    'intelligentFactory':'以三维场景为依托、生产数据为核心、生产业务为纽带，实现工厂园区、车间、流水线、设备的逐级可视，并对生产过程进行综合监管及全局分析，形成智慧工厂管理的新模式。',
    'intelligentCommunity':'依托数字孪生管理理念构建智能化社区服务管理平台，创新管理手段和服务模式，助力新型的平安社区、美丽社区、幸福社区和文明社区的建设。',
    'intelligentBuilding':'智慧楼宇资源合集集合了楼宇数字孪生行业的案例、工具教程和资源。用户使用合集资源可以快速上手ThingJS，打造自己的智慧楼宇数字孪生项目。利用ThingJS平台对楼宇建筑结构及设备位置进行真实展现，并可以集成能耗指标、设备状态参数、楼控系统、监控系统等楼宇各项数据信息，进行可视化综合监控预警，帮助用户构建专属智慧楼宇行业产品。',
    'intelligentTraffic':'智慧交通资源合集整合了智慧交通数字孪生可视化应用开发相关的模板、案例、工具及资源。智慧交通行业开发者可利用这些资源在ThingJS平台中专注于构建跨领域、跨平台的智慧城市可视化应用，以数字孪生可视化技术为核心，助力交通行业实现互通互联，打破信息孤岛，构建数字经济新航运模式，为交通协同提供全局级管理视角。',
    'intelligentCity':'智慧城市资源合集整合了智慧城市数字孪生可视化应用开发相关的模板、案例、工具及资源。智慧城市从业者可利用这些资源在ThingJS平台中专注于构建跨领域、跨平台的智慧城市可视化应用，以全局视角掌控城市业务，为城市治理、经济规划、政务服务、应急指挥等提供有效支撑。',
    'offline':'ThingJS离线开发网络版，是在局域网环境部署的数字孪生可视化项目开发服务器。无需外部网络，保障项目安全；支持不限人数的开发人员共同进行数字孪生可视化项目开发，提升开发效率',
    'offline_SDK':'ThingJS离线开发SDK是在离线环境使用，每个 Key 对应一台计算机进行开发，开发过程有安全保障，基于浏览器管理，无需安装配置开发环境。',
    'onlineDeployment':'ThingJS在线部署支持商用，去掉场景默认水印，发布的项目不带ThingJS 专用 logo。公有云资源完成部署服务器单独部署，无需自建服务器，节约成本。',
    'offlineDeployment':'ThingJS离线部署在本地环境自有服务器部署，无需连接公网，无需云3D资源，保证项目安全性。永久商用授权，项目访问次数无限制。',
    'online_VIP':'ThingJS在线开发VIP支持更多功能、更高效率的开发数字孪生可视化项目，提供更多源码支持、更大的存储空间和更丰富的功能，让可视化项目开发更便捷。',
    'plugin':'森插件 3DsMAX基于 3DsMAX二次开发，帮助美术人员实现一个软件完成所有模型设计工序，包含可视化效果设计，3D模型烘培，3D模型动画，3D模型特效，短时间内创建三维模型，提高美术设计人员模型制作效率，并最终使用一键上传直接交付使用',
    'studio':'森工厂是UINO优锘科技推出的一站式数字孪生开发平台，包含数字孪生工具，到数字孪生产品，资源及服务等，帮助企业一站式解决数字孪生难题，快速开发数字孪生应用',
    'courseDetails':'中关村物联网数字孪生技术学院 由中关村物联网联盟发起，联合北京优锘科技股份有限公司共同成立，数字孪生技术学院将通过Thingjs-X培训平台为核心，面向数字技术领域，全面培养行业专业人才；推出国内首个物联网数字孪生技术开发师职业团体标准，可快速突破技术壁垒，在数字产业化下学习数字孪生技术人员能快速学习掌握技术，实现就业，为智慧城市、数字城市、数字企业提供技术人才；此次发布的数字孪生技术开发师分为初级、中级、高级不同能力的认定，经过培训、考试合格后颁发不同级别的能力证书。',
    'courseDetailTiming':'中关村物联网数字孪生技术学院 由中关村物联网联盟发起，联合北京优锘科技股份有限公司共同成立，数字孪生技术学院将通过Thingjs-X培训平台为核心，面向数字技术领域，全面培养行业专业人才；推出国内首个物联网数字孪生技术开发师职业团体标准，可快速突破技术壁垒，在数字产业化下学习数字孪生技术人员能快速学习掌握技术，实现就业，为智慧城市、数字城市、数字企业提供技术人才；此次发布的数字孪生技术开发师分为初级、中级、高级不同能力的认定，经过培训、考试合格后颁发不同级别的能力证书。',
    'thingclub':'物联网产业元宇宙物联森友会上线，帮100万中国物联网企业，在元宇宙中加速成长',
    'showroom':'森展厅编辑器，是一款零代码、低门槛的物联网元宇宙展厅制作工具，整体采用图形化界面与托拉拽的交互方式，并配备面向物联网场景业务的资源库、提供丰富的物联网模型库，企业无需技术人员，就可以实现零代码配置自己的元宇宙展厅，配置结果所见即所得',
    'thingland':'森大陆是物联元宇宙入口，赋能百万物联网企业，扩展业务范围，提升销售&服务半径，让再小的物联网企业也能被看见，被理解、被需要',
    'bim':'森BIM插是基于AutoDesk Revit进行的插件开发，能快速获取rvt文件中的模型数据，简单配置后一键导出TJS场景。通过森BIM插件Revit，用户可以通过简单的配置，确定导出的建筑结构、层级结构、以及设备/孪生体等需要管理的对象，以园区建筑化结构导出TJS场景资源。',
    'courseNew':'ThingJS开发训练营是由优锘科技推出的数字孪生技术开发课程，帮助学员快速实现从0到1搭建3D数字孪生场景，开发完整的数字孪生项目。课程涵盖ThingJS平台认知+基础语法+开发技巧，能够系统性提升ThingJS开发能力，完整搭建知识系统。并通过实战案例的剖析，帮助学员落地完整项目。完课并通过能力认证考核，即可获得工信部教考中心颁发的“数字孪生系统开发工程师”证书',
    'courseModel':'数字孪生建模师训练营，5天在线学习，技术专家在线答疑，班主任一对一跟进，课后实战演练巩固。5天时间，帮助建模师从入门到精通，独立完成数字孪生应用建模',
    'IOT_Exhibition':' IOTE 2022第十八届国际物联网展·深圳站（简称：IOTE深圳物联网展）将于2022年8月18-20日在深圳会展中心（福田）开展。北京优锘科技股份有限公司将携最新升级的低代码数字孪生开发平台-ThingJS 2.0 及 零代码开发平台Thing-X 精彩亮相展会现场',
    'digitalTwin':'ThingJS推出基于数字孪生教育实训平台，该平台是基于数字孪生的新一代信息技术实训体系，通过结合数字孪生技术和产业项目最佳实践，能够有效解决传统实训成本高昂、场景固化、教学效果不佳问题，打通产教融合最后一公里',
    'quickDT':'想要快人一步？为您诚心推荐QuickDT——ThingJS专属的快速数字孪生应用生成工具。三个核心功能，让您通过分钟级的配置覆盖80%的项目需求；内置众多场景交互工具，助力数字孪生演示；更可无缝对接至低代码开发平台，无惧个性化定制需求',
    'chartBuilder2':'森大屏ChartBuilder一款简单好用的可视化大屏制作工具，提供数据接入和绑定功能，实时更新前端图表数据，与3D场景结合，实现图表与三维场景进行联动交互及可视化大屏UI制作',
    'topoBuilder2':'森拓扑TopoBuilder一款高质量综合在线绘图工具简单易用，支持多人实时在线协作，可绘制2D拓扑图、组态图、电力图、流程图、UML、BPMN、ArchiMate等多种专业图形',
	'template':'若您想为3D场景快速生成商业设计水准的效果呈现，低成本输出酷炫可视化效果，那么ThingJS即将上线的—效果模板插件可满足您的需求。ThingJS效果模板可使一个普通建模和搭建的3D场景在加载效果模板后，一次性呈现出效果模板预设的风格化样式效果',
    'intelligentPower':'全套源码｜配套培训｜平台兼容。您无须从0开始即可快速、无痛搭建一套完整可用的智慧电力可视化“立体沙盘”，更有ThingJS全平台产品祝您数字孪生全流程升级无忧',
    'customizedService':'森拓扑为用户提供拓扑图定制化设计升级改造服务，包含画面的布局、图标的绘制、动画的制作等服务，为您的组态图做一次全方位升级',
    'dcv':'ThingJS-DCV是面向机房管理的专业平台，提供立体化、仿真式、实时互动的可视化管理方式助力提高管理效率。应对复杂机房的管理难题，ThingJS-DCV提供的配套管理功能，助力运维管理人员缩短响应时间，提升工作效率。',
    'development':'ThingJS平台的森服务，可以为用户提供框架代码开发、DEMO配置规划和功能插件开发服务，助力用户快速构建3D可视化项目',
    'modeling':'ThingJS平台的森服务，可以为用户提供模型建模服务、模型优化服务，3D城市模型，切斜摄影处理服务，帮助用户快速搭建3D场景，降低建模门槛',
    'support':'ThingJS平台的森服务，可以为用户提供为期30个自然日的技术指导服务，通过建立一对一5*8微信群方式，由专职技术工程师答复相关技术问题、提供指导和优化建议',
    'training': 'ThingJS平台的森服务，可以为用户提供ThingJS开发培训、数字孪生建模培训、零代码产品培训，可以帮助用户快速入门数字孪生可视化'
};
const SSOLOGIN = {
    COOKIE_LIST: ['role', 'token', 'name', 'openid', 'id', 'accessToken', 'dix_token', 'dix_id', 'mmdId', 'particleRole', 'headimgurl', 'userNick', 'tel', 'email', 'type', 'sceneOid', 'sceneMid', 'user_id','client_id','debugSwitch','switchmenu','switchlog','layoutSelect','ssoAccessToken','refreshToken','SameSite','Secure','thingJsAccessToken','JSESSIONID','dcvRole','sketchUser','musics','thingJsToken','skyboxes','popUp','sso_token','refresh_token','saveSetSwitch','studio_token'],
    ssoLogin: null,
    hostname:window.location.hostname,
    showLogin:false,
    config:null,
    getConfig() {
        if(this.config) return this.config;
        var data=null;
        if(location.hostname=='www.thingjs.com') {
            data={
                name: "thingjs-prod-notsecure",
                client_id: "4KzFc4KfqDhFiSkmHTReMIHrLAaHopteB4upR4ricjqn4aB4aESFzEqX5g6HwZjC",
                redirect_uri: "http://www.thingjs.com/api/sso/login",
                redirect_mode: "script",
                qq_mode: "popup",
                scope: []
            };
            if(location.protocol=='https:') {
                data={
                    name: "thingjs-prod",
                    client_id: "Safoq68tlCWKXcD4q12ZuLAAjqcPCjfdaEmMysQYOCZgNPeDMjHxKpc1V6T6zIXQ",
                    redirect_uri: "https://www.thingjs.com/api/sso/login",
                    redirect_mode: "script",
                    qq_mode: "popup",
                    scope: []
                };
            };
        } else {
            data={
                name: "thingjs-test-notsecure",
                client_id: "NrchzV3fPUq7VBeueRhCZe5rBa6xRqG9JsJKZvniPFDuKvJNrIIQOw0VaOqL8YgI",
                redirect_uri: "http://test-thingjs.3dlink.cn/api/sso/login",
                redirect_mode: "script",
                qq_mode: "popup",
                scope: []
            };
            if(location.protocol=='https:') {
                data={
                    name: "thingjs-test",
                    client_id: "4vOdjlRKtJOOGFIVUmilF9MNi5A3zZa0XU611ekba2vFDJx2KYXeml6chv3mBMx7",
                    redirect_uri: "https://test-thingjs.3dlink.cn/api/sso/login",
                    redirect_mode: "script",
                    qq_mode: "popup",
                    scope: []
                };
            };
        }
        this.config=JSON.parse(JSON.stringify(data));
        return data;
    },
    // cookie有效期
    setTamp(time) {
        var curDate = new Date();
        //当前时间戳
        var curTamp = curDate.getTime();
        if(typeof(time)=='number') {
            time=time*1000;
            return time + curTamp;
        } else {
            //当日凌晨的时间戳,减去一毫秒是为了防止后续得到的时间不会达到00:00:00的状态
            var curWeeHours = new Date(curDate.toLocaleDateString()).getTime() - 1;
            //当日已经过去的时间（毫秒）
            var passedTamp = curTamp - curWeeHours;
            //当日剩余时间
            var leftTamp = 24 * 60 * 60 * 1000 - passedTamp;
            if(leftTamp<0) {
                curWeeHours = new Date(new Date(curDate).Format('yyyy/MM/dd')).getTime() - 1;
                passedTamp = curTamp - curWeeHours;
                leftTamp = 24 * 60 * 60 * 1000 - passedTamp;
            }
            return leftTamp + curTamp;
        }
    },
    // 设置cookie
    setCookie(name, value, d, domain,time){
        var Days = 2;
        if (d) Days = d;
        var exp = new Date();
        // exp.setTime(exp.getTime() + Days * 24 * 60 * 60 * 1000);
        exp.setTime(this.setTamp(time));
        if(this.hostname=='test-thingjs.3dlink.cn') {
            domain = ".3dlink.cn";
        } else {
            if (this.hostname == (SERVERPATH ? "store.thingjs.com" : "www.thingjs.com")) {
                if(!domain) domain = ".thingjs.com";
            } else if (this.hostname == "www.3dmmd.cn") {
                if(!domain) domain = ".3dmmd.cn";
            } else if(window.location.hostname.indexOf('thingjs.com')==0){
                if(!domain) domain = ".thingjs.com";
            }
        }
        if (domain) {
            document.cookie = name + "=" + escape(value) + ";domain=" + domain + ";expires=" + exp.toGMTString() + "; path=/;";
        } else {
            document.cookie = name + "=" + escape(value) + ";expires=" + exp.toGMTString() + "; path=/";
        }
    },
    // 获取cookie
    getCookie(name, decode) {
        var arr, reg = new RegExp("(^| )" + name + "=([^;]*)(;|$)");
        if (arr = document.cookie.match(reg)) {
            if (decode) {
                return decodeURIComponent(arr[2]);
            } else {
                return (arr[2]);
            }
        } else
            return null;
    },
    // 清除cookie
    clearCookie(name) {
        var date = new Date();
        date.setTime(date.getTime() - 10000);
        document.cookie = '_US' + "=;domain=.uino.com;expires=" + date.toGMTString() + ";path=/";
        if(name) {
            document.cookie = name + "=; expires=" + date.toGMTString();
            if(this.hostname=='test-thingjs.3dlink.cn') {
                document.cookie = name + "=;domain=.3dlink.cn;expires=" + date.toGMTString() + ";path=/";
            } else {
                document.cookie = name + "=;domain=.thingjs.com;expires=" + date.toGMTString() + ";path=/";
                document.cookie = name + "=;domain=.3dmmd.cn;expires=" + date.toGMTString() + ";path=/";
            }
            $.removeCookie(name, { path: '/' });
            $.removeCookie(name);
            return;
        }
        var keys = document.cookie.match(/[^ =;]+(?=\=)/g);
        // var id = this.getCookie('id');
        // var mmdId = this.getCookie('mmdId');
        // loginout_mmd(id, mmdId); //退出
        if (keys) {
            for (var i = keys.length; i--;) {
                if (this.COOKIE_LIST.indexOf(keys[i]) >= 0) {
                    document.cookie = keys[i] + "=; expires=" + date.toGMTString();
                    if(this.hostname=='test-thingjs.3dlink.cn') {
                        document.cookie = keys[i] + "=;domain=.3dlink.cn;expires=" + date.toGMTString() + ";path=/";
                    } else {
                        document.cookie = keys[i] + "=;domain=.thingjs.com;expires=" + date.toGMTString() + ";path=/";
                        document.cookie = keys[i] + "=;domain=.3dmmd.cn;expires=" + date.toGMTString() + ";path=/";
                    }
                    $.removeCookie(keys[i], { path: '/' });
                    $.removeCookie(keys[i]);
                }
            }
        }
    },
    // 初始化登录
    async init(type) {
        this.ssoLogin=null;
        this.getConfig();
        if (!this.ssoLogin) {
            var data=this.config;
            if(type) {
                data.login_method='phone';
            } else {
                data.login_method='password';
            }
            if(typeof(LOADSTATUS)=='undefined') {
                this.ssoLogin = new _SSO(data);
            } else {
                if(LOADSTATUS&&LOADSTATUS.SSO) {
                    this.ssoLogin = new _SSO(data);
                }
            }
        }
        return this.ssoLogin;
    },
    // 登录弹窗
    async login(type) {
        let _this = this;
        if(this.showLogin) return;
        let ssoLogin = await this.init();
        if(type=='init') {
            // console.log('init login');
            this.showLogin=false;
        } else {
            // console.log('login');
            var login = await this.checkLogin();
            if(login!='fail') {
                this.showLogin=false;
                return;
            }
        }
        if(this.showLogin) return;
        let loginElement = ssoLogin.showLogin();
        this.showLogin=true;
        loginElement.addEventListener('closeLogin', (data) => {
            // console.log(data);
            _this.closeLogin();
        })
    },
    // 注册界面
    async register(type){
        let _this = this;
        if(this.showLogin) return;
        let ssoLogin = await this.init('register');
        if(type=='init') {
            console.log('init register');
            this.showLogin=false;
        } else {
            console.log('register')
            var login =  await this.checkLogin();
            if(login!='fail') {
                this.showLogin=false;
                return;
            }
        }
        if(this.showLogin) return;
        let loginElement = ssoLogin.showRegister();
        this.showLogin=true;
        loginElement.addEventListener('closeLogin', (data) => {
            // console.log(data);
            _this.closeLogin();
        })
    },
    async checkLogin(){
        let _this = this;
		return new Promise((resolve, reject)=>{
            if(!_this.ssoLogin) _this.init();
            if(_this.ssoLogin) {
                try {
                    _this.ssoLogin.probe().then(res => {
                        // console.log(res);
                        if(res=='未登录') {
                            resolve('fail');
                        } else {
                            resolve(res);
                        }
                    }).catch(e => {
                        console.log(e);
                        resolve("fail");
                    })
                } catch (error) {
                    console.log(error);
                    resolve(error);
                }
            } else {
                resolve("ssologin is null");
            }
        })  
    },
    async refresh(){
        let _this = this;
        var p=new Promise((resolve, reject)=>{
            if(!_this.getCookie('token')) {
                // console.log('请重新登录');
                return  resolve('fail');
            }
            if(_this.getCookie('refresh_token')) {
                if(!_this.getCookie('sso_token')) {
                    _this.checkLogin().then(res=>{
                        if(res=='fail') {
                            return resolve('fail');
                        } else {
                            return resolve('ok');
                        }
                    }).catch(e=>{
                        console.log(e);
                        return resolve(e);
                    });
                } else {
                    // console.log('已登录');
                    return resolve('ok');
                }
            } else {
                // console.log('请重新登录');
                return resolve('fail');
            }
        });
        return await p;
    },
    async detectLogin(res){
        let _this = this;
        if(_this.getCookie('refresh_token')){
            if (res.sso_token) this.setCookie('sso_token', res.sso_token,null,null,7200);
        }else{
            _this.checkLogin();
        }
    },
    // 退出登录
    logout(){
        try {
            fetch('/api/sso/logout_sso').then(res=>res.json()).then(res=>{
                console.log(res);
            }).catch(e=>{
                console.log(e);
            })
        } catch (error) {
            console.log(error);
        }
        try {
            if (this.ssoLogin) {
                this.ssoLogin.closeLogin();
            }
        } catch (error) {
            console.log(error);
        }
        this.ssoLogin = null;
        this.showLogin=false;
        this.clearCookie();
    },
    // 关闭登录弹窗
    closeLogin(type) {
        try {
            if (this.ssoLogin) {
                this.ssoLogin.closeRegister();
            }
        } catch (error) {
            console.log(error);
        }
        try {
            if (this.ssoLogin) {
                this.ssoLogin.closeLogin();
            }
        } catch (error) {
            console.log(error);
        }
        this.showLogin=false;
        // this.ssoLogin = null;
    },
    // 登录成功回调
    loginBack(res) {
        try {
            if (this.ssoLogin && typeof (this.ssoLogin) == 'function') {
                this.ssoLogin.closeLogin();
                this.ssoLogin = null;
            }
        } catch (error) {};
        try {
            if((location.host=='test-thingjs.3dlink.cn'||location.host=='www.thingjs.com')&&location.pathname=="/guide/"&&(window.location.pathname == '/guide/main/'||window.location.search.indexOf('?m=sample') == 0)) {
                $('#content_sample .content-browser .browser-header .editScene').html(`<div style="margin-right: 7px;
                text-align: center;
                cursor: pointer;
                white-space: nowrap;
                text-overflow: ellipsis;
                color: #ffffff;
                background-color: #ec7600;
                width: 70px;
                height: 23px;
                font-size: 12px;
                line-height: 12px;
                padding: 6px;
                border-radius: 2px;
                margin-top: 3px;"  onclick="editShowScene()">编辑场景</div>`);
            }
        } catch (error) {
            console.log(error);
        }
        this.showLogin=false;
        this.clearCookie();
        this.setCookie('SameSite', 'None');
        this.setCookie('Secure', true);
        this.setCookie("saveSetSwitch", 0);
        this.setCookie("switchlog", 1);
        if (res.id) this.setCookie('id', res.id);
        if (res.role) this.setCookie('role', res.role);
        if (res.refresh_token) this.setCookie('refresh_token', res.refresh_token,null,null,7500);
        if (res.sso_openid) this.setCookie('studio_token', res.sso_openid,null,null,7200);
        if (res.sso_token) this.setCookie('sso_token', res.sso_token,null,null,7200);
        if (res.token) this.setCookie("token", res.token);
        if (res.accessToken) this.setCookie('accessToken', res.accessToken);
        if (res.mmdId) this.setCookie("mmdId", res.mmdId);
        if (res.openid) this.setCookie("openid", res.openid);
        try {
            if (res.name) res.name = decodeURIComponent(res.name);
        } catch (error) {}
        try {
            if (res.name) res.name = encodeURI(res.name);
        } catch (error) {}
        if (res.name) this.setCookie("name", res.name);
        if (res.client_id) this.setCookie("client_id", res.client_id);
        if (!res.headimgurl) {
            this.setCookie('headimgurl', 'https://www.thingjs.com/guide/image/tx.png');
        } else {
            if (window.location.protocol == "https:") {
                if (res.headimgurl.indexOf("http:") == 0) {
                    res.headimgurl = "https" + res.headimgurl.substring(4);
                }
            }
            this.setCookie('headimgurl', res.headimgurl);
        }
        // try{
        //     getSignJurisdiction()
        // }catch(e){}
        try {
            PERMISSIONCONFIG.initPermission(res.mmdId);
        } catch (error) {}
        try {
            sourceRoles();
        } catch (error) {};
        
        // 注册（知乎，360，百度）OCPC布码
        try {
            window._agl && window._agl.push(['track', ['success', {t: 3}]]) // 百度
        } catch (error) {};
        try {                    
            window.zhad && window.zhad.push({eventtype: 'js_submit'}) // 知乎
        } catch (error) {};
        try {    
            // if(res.isOneLoginuser){
                // 360注册监听              
                postOcpcTSZ()
                // 百度注册监听
                postOcpcBD()
                // console.log("360注册监听");
                postOcpcZH()
            // }
        } catch (error) {};
        return 'ok';
    },
    // 模拟登录
    async loginByUser(url) {
        var _this=this;
        return new Promise((resolve, reject)=>{
            url=location.origin+url;
            if(!_this.ssoLogin) _this.init();
            if(_this.ssoLogin) {
                try {
                    _this.ssoLogin.probe();
                    setTimeout(()=>{
                        window.location.href=url;
                    },0);
                    resolve('ok');
                } catch (error) {
                    console.log(error);
                    resolve('fail');
                }
            } else {
                resolve('fail');
            }
        })
    }
};
SSOLOGIN.getConfig();
// const ModelUrl = "http://47.93.81.139:3000"
// const ModelServer = "http://modeldepot.3dmomoda.com:3000"
const ModelServer = "https://store.thingjs.com/api"
// const ModelServer="http://127.0.0.1:3000"
// const ModelServer="http://model.3dmomoda.cn/support/api"
// const MaxUrl = 'http://47.93.81.139:9115';
const MaxUrl = 'https://www.thingjs.com/3dmodel/api';
const Modelfilter = ['已上传的模型','CB上传的模型','已购买的模型','Skfb'];
var sketchfabModel = [];
var ObjModel = [],
    BuyModel = [];
var app_code = null;
var js_nums;
var scene_nums;
const FILEUPL_FAIL = " \\\/:*?\"<>|'#@%&$";
const SCENE_TYPE = ['.zip', '.tjs'];
const UPLOAD_TYPE = ['.html', '.javascript', '.js', '.css', '.json', '.ico', '.icon', '.jpg', '.png', '.gif', '.jpeg', '.woff', '.ttf', '.gltf', '.mp3','.mp4','.srt','.ass','.otf','.woff2','.eot','.geojson', '.bin', '.ifc','.svg','.glb','.vue'];
const CANEDIT_TYPE = ['html', 'javascript', 'css', 'json', 'js', 'cht', 'map', 'cps', 'ico', 'jpg', 'png', 'gif', 'jpeg', 'mp4', 'mp3','geojson','svg','vue'];
const IGMORE_TYPE = ['ico', 'jpg', 'png', 'gif', 'jpeg', 'mp4', 'mp3'];
const TEXTURE_TYPE = ['.jpg', '.png', '.jpeg'];
const MUSIC_TYPE = ['.mp3', '.wav', '.ogg'];
const FILEUPLOADPATTEN = new RegExp('[' + FILEUPL_FAIL + ']', "m");
const myscenePageSize = 8;
const sceneNameLength = 128; // 上传场景文件名长度限制
var sampleType;
var ORIGINOPENID;
var sampleTimeout;
var IFSHOWLOGIN=true;
function onMenu(n, url, menu) {
    if(location&&location.pathname&&location.pathname=='/user/index.html'&&n&&n=='main') {
        return;
    }
    if(menudic[n]=='./html/sample_test.html'&&(location.host=='test-thingjs.3dlink.cn'||location.host=='www.thingjs.com')) {
        if(location.pathname!='/guide/') {
            return;
        }
    }
    if(location.href.indexOf('www.thingjs.com/thingjs-x')!=-1) {
        window.AnalysysAgent.init({
            appkey: "36a2d06e80f2df66", //APPKEY
            debugMode: 0,
            uploadURL: 'https://www.thingjs.com/argo',
            visitorConfigURL: 'https://www.thingjs.com/argo', // 可视化
            /**如无自定义配置，则与uploadURL相同**/
            autoHeatmap: true, // 点击位置热图、点击元素热图
            autoWebstay: true,
            autoTrack: false, // 全埋点
            encryptType: 1, // 默认不加密0 加密1，2
            sendType:"post", // 接口上传日志
            // SDKFileDirectory: '../sdk/',       //可视化模块SDK与热图模块SDK存放目录
            autoClickBlackList: function () { //设置全埋点统计黑名单 页面地址`url`内包含'?m=sample'的页面不进行事件采集
                var url = window.location.href
                if (url.indexOf('?m=sample') > -1) {
                    return true
                }
                return false
            },
            heatMapBlackList: function () { // 设置热图黑名单 true 不进行采集; false 采集
                var url = window.location.href;
                var num = url.indexOf('://');
                var urlName = url.slice(num);
                if (urlName == '://www.thingjs.com/guide/' || urlName == '://www.thingjs.com/guide/?m=main' || urlName == '://www.thingjs.com/guide/price') {
                    return false
                }
                if (url.indexOf('/guide/?hmsr=') > -1) { // 外部链接访问
                    return false
                }
                return true
            }
        })
        window.AnalysysAgent && window.AnalysysAgent.profileSetOnce('isregistered', '否'); //默认未注册
        window.AnalysysAgent && window.AnalysysAgent.profileSet('last_access_time', new Date().Format('yyyy-MM-dd hh:mm:ss')); // 最近一次访问时间
        return;
    }
    if($('#sub-site-nav .nav-link[data-name='+n+']')){
        $('#sub-site-nav .pingtaiyuyingyong').removeClass("nav-barTwo");
        $('#sub-site-nav .nav-link[data-name='+n+']').addClass("nav-bar").siblings().removeClass("nav-bar");
    }
    var pathname=location.pathname;
    // console.log(pathname)
    if(n == 'campus' 
        || n == 'city' 
        || n == 'mod' 
        || n == 'building' 
        || n == 'fire' 
        || n == 'safety' 
        || n == 'port' 
        || n == 'granary'
        || n == 'chartBuilder'
        || n == 'dix'
        || n == 'liveServer'
        || n == 'topoBuilder'
        || n == 'intelligentCity'
        || n == 'intelligentBuilding'
        || n == 'intelligentMine'
        || n == 'intelligentHospital'
        || n == 'intelligentSchool'
        || n == 'intelligentCampus'
        || n == 'intelligentTraffic'
        || n == 'digitalPowerGrid'
        || n == 'intelligentFactory'
        || n == 'intelligentCommunity'
        || n == 'online_VIP'
        || n == 'onlineDeployment'
        || n == 'offlineDeployment'
        || n == 'offline_SDK'
        || n == 'offline'
        || n == 'schoolScenesCompetetion'
        || n == 'voteForScenes'
    ){
        $('#sub-site-nav .pingtaiyuyingyong').addClass("nav-barTwo").siblings()
    }else if(n == 'thingjsPlatform' || n == 'pano'){
        $('#sub-site-nav .pingtaiyuyingyong').addClass("nav-barThree").siblings()
    } else if(n=='main') {
        if(pathname == '/guide/campus/' 
        || pathname == '/guide/city/' 
        || pathname == '/guide/mod/' 
        || pathname == '/guide/building/' 
        || pathname == '/guide/fire/' 
        || pathname == '/guide/safety/' 
        || pathname == '/guide/port/' 
        || pathname == '/guide/granary/'
        || pathname == '/guide/chartBuilder/'
        || pathname == '/guide/dix/'
        || pathname == '/guide/liveServer/'
        || pathname == '/guide/topoBuilder/'
        || pathname == '/guide/intelligentCity/'
        || pathname == '/guide/intelligentMine/'
        || pathname == '/guide/intelligentHospital/'
        || pathname == '/guide/intelligentSchool/'
        || pathname == '/guide/intelligentCampus/'
        || pathname == '/guide/digitalPowerGrid/'
        || pathname == '/guide/intelligentFactory/'
        || pathname == '/guide/online_VIP/'
        || pathname == '/guide/onlineDeployment/'
        || pathname == '/guide/offlineDeployment/'
        || pathname == '/guide/offline_SDK/'
        || pathname == '/guide/offline/'
        || pathname == 'schoolScenesCompetetion'
        || pathname == 'voteForScenes'
        || pathname == '/guide/intelligentCommunity/') {
            $('#sub-site-nav .pingtaiyuyingyong').addClass("nav-barTwo").siblings()
        }
    }
    
    if (window.location.pathname == '/admin/') return;
    if (!menudic[n]&&window.location.search!='') {
        console.error('参数错误');
        return;
    }
    // if(n.indexOf("speedpro-")==0){
    //     menudic[n] = './html/speedCityDetailPages/'+n.split("-")[1];
    // }else{
    //     if (!menudic[n]) {
    //         console.error('参数错误');
    //         return;
    //     }
    // }
    if (n === 'sample' || n === 'wisdomScenarioVDC' || n === 'imgGrade' || n === 'schoolScenesCompetetion'|| n === 'voteForScenes'|| location.pathname.indexOf('schoolScenesCompetetion')!=-1|| location.pathname.indexOf('voteForScenes')!=-1|| location.pathname.indexOf('service')!=-1|| location.pathname.indexOf('wx_userinfo')!=-1) {
        $('.navHeader.slide-bottom.fix').remove();
    }
    if (n === 'sample' && window.location.search.indexOf('?m=sample') < 0) {
        window.open(window.location.protocol + "//" + window.location.host + '/guide/?m=sample');
    }
    if(window.location.search!='') {
        $('#THINGJSTITLE').text(menutitle[n]);
        if (menuKeywords[n]) {
            $('meta[name=keywords]').attr('content', menuKeywords[n]);
        } else {
            $('meta[name=keywords]').attr('content', menuKeywords['main']);
        }
        if (menuDescription[n]) {
            $('meta[name=description]').attr('content', menuDescription[n]);
        } else {
            $('meta[name=description]').attr('content', menuDescription['main']);
        }
    }
    // init JS-SDK (after title change)
    try{
        window.AnalysysAgent.init({
            appkey: "36a2d06e80f2df66", //APPKEY
            debugMode: 0,
            uploadURL: 'https://www.thingjs.com/argo',
            visitorConfigURL: 'https://www.thingjs.com/argo', // 可视化
            /**如无自定义配置，则与uploadURL相同**/
            autoHeatmap: true, // 点击位置热图、点击元素热图
            autoWebstay: true,
            autoTrack: false, // 全埋点
            encryptType: 1, // 默认不加密0 加密1，2
            sendType:"post", // 接口上传日志
            // SDKFileDirectory: '../sdk/',       //可视化模块SDK与热图模块SDK存放目录
            autoClickBlackList: function () { //设置全埋点统计黑名单 页面地址`url`内包含'?m=sample'的页面不进行事件采集
                var url = window.location.href
                if (url.indexOf('?m=sample') > -1) {
                    return true
                }
                return false
            },
            heatMapBlackList: function () { // 设置热图黑名单 true 不进行采集; false 采集
                var url = window.location.href;
                var num = url.indexOf('://');
                var urlName = url.slice(num);
                if (urlName == '://www.thingjs.com/guide/' || urlName == '://www.thingjs.com/guide/?m=main' || urlName == '://www.thingjs.com/guide/price') {
                    return false
                }
                if (url.indexOf('/guide/?hmsr=') > -1) { // 外部链接访问
                    return false
                }
                return true
            }
        })
    }catch (error) {

    }
    window.AnalysysAgent && window.AnalysysAgent.profileSetOnce('isregistered', '否'); //默认未注册
    window.AnalysysAgent && window.AnalysysAgent.profileSet('last_access_time', new Date().Format('yyyy-MM-dd hh:mm:ss')); // 最近一次访问时间
    if((location.pathname!='/guide/'&&location.search=='')||(location.pathname=='/guide/price/')) {
        if ($('footer').length == 1 && n !== 'wisdomScenarioVDC'&& n !== 'schoolScenesCompetetion'&&location.pathname.indexOf('schoolScenesCompetetion')==-1&& n !== 'voteForScenes'&&location.pathname.indexOf('voteForScenes')==-1&&location.pathname.indexOf('service')==-1&&location.pathname.indexOf('wx_userinfo')==-1) {
            // $.ajax({
            //     url: '/guide/html/footer.html',
            //     type: "GET",
            //     dataType: "html",
            //     success: function (d) {
            //         var dcvRole = getCookie("dcvRole");
            //         if (dcvRole == 'true') {
            //             var d1 = d.replace(/style="display:none;"/, '');
            //             $('footer')[0].innerHTML = d1;
            //         } else {
            //             $('footer')[0].innerHTML = d;
            //         }
            //     }
            // });
            $.ajax({
                url: '/guide/html/footerNew.html',
                type: "GET",
                dataType: "html",
                success: function (d) {
                    var dcvRole = getCookie("dcvRole");
                    if (dcvRole == 'true') {
                        var d1 = d.replace(/style="display:none;"/, '');
                        $('footer')[0].innerHTML = d1;
                    } else {
                        $('footer')[0].innerHTML = d;
                    }
                }
            });
        }
    }else {
        if(location.pathname=='/guide/loadingForPass/') {
            return;
        } else {
            if(window.location.pathname == '/user/'){
                return;
            }else {
                if(menudic[n]&&(menudic[n]=='./html/mainNew.html'||menudic[n]=='./html/mainNew2.html')&&(location.host=='test-thingjs.3dlink.cn'||location.host=='127.0.0.1'||location.host=='www.thingjs.com')&&location.pathname.split('/').length>=4) {
                    return;
                }
                $.ajax({
                    url: menudic[n],
                    type: 'get',
                    dataType: 'html',
                    success: function (htmlData) {
                        $('#content').html(htmlData);
                        if (url) {
                            var m = '#sample_01_Hello';
                            if (menu) m = menu;
                            if (menu == 1) {
                                manageSample(m, url);
                            } else {
                                manageSample($(m), url);
                            }
                        }
                        //添加页脚
                        // n !== 'wisdomScenarioVDC'是在那个页面不插入footer
                        if ($('footer').length == 1 && n !== 'wisdomScenarioVDC'&& n !== 'schoolScenesCompetetion'&&location.pathname.indexOf('schoolScenesCompetetion')==-1&& n !== 'voteForScenes'&&location.pathname.indexOf('voteForScenes')==-1&&location.pathname.indexOf('service')==-1&&location.pathname.indexOf('wx_userinfo')==-1) {
                            // $.ajax({
                            //     url: '/guide/html/footer.html',
                            //     type: "GET",
                            //     dataType: "html",
                            //     success: function (d) {
                            //         var dcvRole = getCookie("dcvRole");
                            //         if (dcvRole == 'true') {
                            //             var d1 = d.replace(/style="display:none;"/, '');
                            //             $('footer')[0].innerHTML = d1;
                            //         } else {
                            //             $('footer')[0].innerHTML = d;
                            //         }
                            //     }
                            // });
                            $.ajax({
                                url: '/guide/html/footerNew.html',
                                type: "GET",
                                dataType: "html",
                                success: function (d) {
                                    var dcvRole = getCookie("dcvRole");
                                    if (dcvRole == 'true') {
                                        var d1 = d.replace(/style="display:none;"/, '');
                                        $('footer')[0].innerHTML = d1;
                                    } else {
                                        $('footer')[0].innerHTML = d;
                                    }
                                }
                            });
                        }
                    }
                });
            }
        }
    }
    

    var aObj = $('.navbar-nav').find('.nav-link');
    // for (var i = 0; i < aObj.length; i++) {
    //     if (n == aObj[i].getAttribute('data-act')) {
    //         $(aObj[i]).addClass('active');
    //         $(aObj[i]).parent("li").parent("ul").parent(".nav-menu").find('.nav-link').first().addClass('active');
    //     } else {
    //         $(aObj[i]).removeClass('active');
    //     }
    // }
    if ((getCookie("openid") == null || getCookie("openid") == '') && (getQueryString("login") == '1' || getQueryString("login") == 't')) {
        loginwindowon();
    }
    if (getQueryString("login") == 'o') {
        try {
            SSOLOGIN.logout();
            indexlogininit('logout');
        } catch (error) {
            clearAllCookie();
            indexlogininit();
        }
    }
    if (getQueryString("login") == '2') {
        loginwindowon(null, "2");
    }
    if (getQueryString("login") == '3') {
        loginwindowon(null, "3");
    }
    // if(getQueryString("trigger")=="help"){
    //     checkLogin()
    // }
}

var path = window.location.protocol + "//" + window.location.host;

function getUserPath() {
    var filename = $('#bfilen').data('nameBefore');
    if (userpath) {
        var datapushpath = userpath + "/" + filename + ".json";
    } else {
        var datapushpath = "../examples/js/" + filename + ".json";
    }
    return datapushpath;
}
var isLoginOther = false;
var isALert = false;

// function changeAutoPlayFlag(string) {
//     if (string == 'end') {
//         //console.log(swiper + 'show swiper');
//         swiper.navigation.$nextEl.css('display', 'block');
//         swiper.navigation.$prevEl.css('display', 'block');
//         swiper.autoplay.stop();
//        // console.log('swiper.autoplay.stop()----')
//     } else {
//         swiper.navigation.$nextEl.css('display', 'none');
//         swiper.navigation.$prevEl.css('display', 'none');
//         swiper.autoplay.start();
//        // console.log('swiper.autoplay.start()--------')
//     }
// }

/**
 *为指引功能增加判断
 */
// 成为开发者
var subject;
window.alert = function (msg, type, msgType, title) {
    try{
        if($(str).length) if($(msg).text().split('').pop() != '！') msg += '！';
    } catch (e) {
        if (msg.split('').pop() != '！') msg += '！'
    }
    if (type == undefined) {
        type = 'info'
    }
    if (type == 'success') {
        newAlert(msg, type, null, null, 'false');
    } else if (type == 'sucsure') {
        newAlert(msg, 'success');
    } else if (type == 'error' && msg == '登录已过期，请重新登录！') {
        newAlert(msg, type);
    } else {
        newAlert(msg, type);
    }
    if (msgType == 'code') {
        swal({
            // position: 'top',
            title: title ? title : "请复制授权码",
            html: title ? $('<textarea>').addClass('swal2-textarea swal2-json').html(msg) : $('<textarea>').addClass('swal2-textarea').html(msg),
            confirmButtonText: '复制',
            showConfirmButton: true
        }).then(function (value) {
            if (value.value) {
                var code = $('.swal2-textarea');
                code.select(); // 选择对象
                document.execCommand("Copy"); // 执行浏览器复制命令
                newAlert('复制成功！', 'success', null, null, 'false');
            }
        })
        $('.swal2-container').addClass('newalert').find('.swal2-content').css({
            'width': 400
        });
    }
    if (msgType == 'renewal') {
        swal({
            // position: 'top',
            type: 'error',
            title: msg,
            confirmButtonText: '确定',
            showConfirmButton: true
        }).then(function (value) {
            if (value) {
                window.close();
            }
        });
        $('.swal2-container').addClass('newalert');
    }
}

function randomWord(randomFlag, min, max) {
    //var feed = Math.random();
    var feed = 0.5;
    var str = "",
        range = min,
        arr = ['0', '1', '2', '3', '4', '5', '6', '7', '8', '9', 'A', 'B', 'C', 'D', 'E', 'F', 'G', 'H', 'I', 'J', 'K', 'L', 'M', 'N', 'O', 'P', 'Q', 'R', 'S', 'T', 'U', 'V', 'W', 'X', 'Y', 'Z'];
    // 随机产生
    if (randomFlag) {
        range = Math.round(feed * (max - min)) + min;
    }
    for (var i = 0; i < range; i++) {
        pos = Math.round(feed * (arr.length - 1));
        str += arr[pos];
    }
    return str;
}
//获取hashcode
function gethashcode() {
    //定义一个时间戳，计算与1970年相差的毫秒数  用来获得唯一时间
    var timestamp = (new Date()).valueOf();
    var myRandom = randomWord(false, 6);
    var hashcode = hashCode(myRandom + timestamp.toString());
    return hashcode;
}

function getNum(num) {
    var price = String(num);
    if (price.length > 3) {
        var arr = price.split('');
        arr = arr.reverse();
        arr.splice(3, 0, ',');
        arr = arr.reverse();
        price = arr.join('');
    }
    return price;
}

// 版本下载
/** 新增判断，当用户处于指引状态下，屏蔽退出按钮 */
function closeDwn() {
    if (document.getElementById("startTeach")&&document.getElementById("startTeach").style.color == 'red') {} else {
        $(".DwnSel").hide()
        $(".shadowPage").hide()
        $(".toolContainer").hide()
    }
}

function showDwn() {
    var openid = getCookie("openid");
    if (!openid) {
        clearAllCookie();
        loginwindowon();
    }else{
        //新增点击下载CampusBuilder触发的事件
        if (document.getElementById("startTeach")&&document.getElementById("startTeach").style.color == 'red') {
            setTimeout('introThree_addThree()', 300);
        }
        $(".shadowPage").show()
        $(".toolContainer").show()
        $(".DwnSel").show()
        // $.ajax({
        //     url: "https://www.thingjs.com/static/CampusBuilder/index.json",
        //     type: "get",
        //     dataType: "json",
        //     success: function (data) {
        //         console.log(data)
        //         $('#client_version').text(data.版本号);
        //         $('#client_size').text(data.文件大小);
        //         $('#client_time').text(data.更新时间);
        //         $('#client_md5').text(data.MD5);
        //         $('#client_64').attr('onclick', "javascript:void(location.href='" + data['64位下载'] + "');");
        //         $('#client_2020').attr('onclick', "javascript:void(location.href='" + data['2020版本下载'] + "');");
        //         // $('#client_32').attr('onclick', "javascript:void(location.href='" + data['32位下载'] + "');");
        //         $('#client_ten').attr('onclick', "javascript:void(window.open('" + data['腾讯微云'] + "'));");
        //         // $('#client_over').attr('onclick', "javascript:void(window.open('" + data['海外网盘'] + "'));");
        //         // $('#client_baidu').attr('onclick', "javascript:void(window.open('" + data['百度网盘'] + "'));");
        //     }
        // })
        // var data = GETDOCUMENTJSON(flag,'campClient');
        var data = toolConfigData.campClient;
        $('#client_version').text(data.info[1].content);
        $('#client_size').text(data.info[0].content);
        $('#client_time').text(data.info[2].content);
        $(".tool_info_ul li:last-child .item_right").text(data.info[3].content)
        $(".link_box a").text(data.link[0].name);
        $('#client_ten').attr('onclick', "javascript:void(window.open('" + data.link[0].url + "'));");
        $(".toolRight h3").text(data.name);
        $('#client_2020').text(data.btnfont);
        $('#client_2020').attr('onclick', "javascript:void(location.href='"+ data.downloadurl+"');");

    }
}
// 创建项目
// ---已废弃---
// $(".creProduct .content .tab").on("click", "span", function () {
//     $(".creProduct .content .tab span").not($(this)).removeClass("active");
//     $(".creProduct .content .Productlist .ProductMain").not($(".creProduct .content .Productlist .ProductMain").eq($(this).index())).hide();
//     $(this).addClass("active")
//     $(".creProduct .content .Productlist .ProductMain").eq($(this).index()).css({
//         "display": "flex"
//     });
// })
// 关闭项目面板
function pannelClose() {
    $(".creProduct,.pay-mb").hide();
}
// 显示项目面板
function pannelShow() {
    $(".creProduct,.pay-mb").show();
}
// 列表选择,弃用
function CreProductList(url, insertTo, type) {
    return;
    if (type) {
        $('.creProduct .title h6').html('快速搭建');
        $('.self_cre,.demoList,.officialList').hide();
        $('.thingcb').show();
    } else {
        $('.thingcb').hide();
        $('.creProduct .title h6').html('新建项目');
        $('.self_cre,.demoList,.officialList').show();
    }
    var uname = getUserName('name');
    if (url == '/api/scenefiles' && !uname) {
        createScene([], url, insertTo);
        return;
    }
    $.ajax({
        url: url,
        type: 'get',
        dataType: 'json',
        async: false,
        success: function (data) {
            if (data.fileAllMenu) data = data.fileAllMenu;
            createScene({
                list: data,
                type: type
            }, url, insertTo, type);
        },
        error: function () {
            createScene([], url, insertTo, type);
        }
    })
}
/*  上传场景开始 */
var myscenelist = [];
var xhrOnProgress = function (fun) {
    xhrOnProgress.onprogress = fun;
    return function () {
        var xhr = $.ajaxSettings.xhr();
        if (typeof xhrOnProgress.onprogress !== 'function') return xhr;
        if (xhrOnProgress.onprogress && xhr.upload) {
            xhr.upload.onprogress = xhrOnProgress.onprogress;
        }
        return xhr;
    }
}

function createScene(data, url, insertTo, type) {
    data.baseUrl = path;
    if (url == './demo.json' || url == '../../guide/demo.json') {
        var html = template('product-demo', data);
    } else if (url == '/api/scenefiles') {
        myscenelist = [];
        if (data.list) myscenelist = data.list;
        // console.log(data);
        var html = template('self_cre', data);
    } else if (url == './scenes.json' || url == '../../guide/scenes.json') {
        var html = template('product-offcial', data);
    } else {
        var html = template('thing_cb', data);
    }
    $(insertTo).html(html);
    if (type != 'cb') {
        if (myscenelist.length >= myscenePageSize) {
            $(".creProduct .content .Productlist .ProductMain").find(".officialList,.demoList").hide();
        } else {
            $(".creProduct .content .Productlist .ProductMain").find(".officialList,.demoList").show();
        }
    }
}

function newResourseFileList(filename, fileurl, dirEle, time) {
    if($('.curList').find("[data-url='"+fileurl+"']").length) return;
    if($('.curList').find('.lifileResoure.lifile.team.active').length) {
        return;
    }
    var li = document.createElement('li');
    li.className = 'lifile';
    $(li).attr('data-name', filename);
    $(li).attr('data-url', fileurl);
    String.prototype.sub = function (n) {
        var r = /[^\x00-\xff]/g;
        if (this.replace(r, "mm").length <= n) return this;
        var m = Math.floor(n / 2);
        for (var i = m; i < this.length; i++) {
            if (this.substr(0, i).replace(r, "mm").length >= n) {
                return this.substr(0, i) + "...";
            }
        }
        return this;
    };
    var liText = $('<span class="_name" title=' + filename + '>' + filename.sub(12) + '</span>' + lifile_time(time));
    $(li).append(liText);
    dirEle.children('.pro_main').after(li);
    if (dirEle.parents('.lifile').length && !dirEle.parents('.lifile').find(".iconfont.icon-file").length) { //判断是否存在icon
        dirEle.parents('.lifile').addClass("lifileResoure");
        var iEle = '<i class="iconfont icon-file .active" title="展开项目资源"></i>'
        dirEle.parents('.lifile').prepend(iEle);
    }
    detailForBIMli($(li));
    if($(li).parent('ul').parent('.lifileResoure').parent('.curList').length) {
        $(li).attr('style', 'text-indent: 22px');
    } else {
        $(li).attr('style', 'text-indent: 11%');
    }
}
//新建资源文件
function newResourseFile(path, filename, dirEle, type) {
    var leaderid = getLeaderid();
    $.ajax({
        url: '/api/newResource',
        dataType: 'json',
        type: 'POST',
        data: JSON.stringify({
            path: path,
            filename: filename,
            leaderid: leaderid
        }),
        cache: false,
        processData: false,
        contentType: false,
        success: function (result) {
            if (result.code == 200) {
                $(".add_file_li").remove();
                if (type) {
                    // newAlert('文件新建成功aa！', 'success', null, null, 'false');
                    $('#list1 li.curLi .iconfont.icon-shuaxin').trigger('click');
                    openFile(path);
                    return;
                }
                newResourseFileList(filename, result.fileurl, dirEle, new Date());
                // newAlert('新建成功aa！', 'success', null, null, 'false')
            } else {
                newAlert(result.message + '!', 'error')
            }
        }
    })
}
// 上传场景和文件资源
function clickupload(para) {
    var fd = new FormData();
    if (!$('.sceneUpload #file')[0].files[0]) {
        newalert('请选择要上传的文件', 'warning');
        return;
    }

    var filename = $('.sceneUpload #file')[0].files[0].name;
    var resFileName = filename.split('.').slice(0, filename.split('.').length - 1).join('.');
    var postf = $('.sceneUpload #file')[0].files[0].type.split('/')[$('.sceneUpload #file')[0].files[0].type.split('/').length - 1].toLocaleLowerCase();
    var postn = $('.sceneUpload #file')[0].files[0].name.indexOf('.') > -1 ? $('.sceneUpload #file')[0].files[0].name.split('.')[$('.sceneUpload #file')[0].files[0].name.split('.').length - 1].toLocaleLowerCase() : '';
    var f = filename.substring(0, filename.lastIndexOf('.'));
    var ifOverRide = $('.bg-upload .bg-box .ifOverRide .input-radio .input-style-radio .input-r:first')[0].checked ? 1 : 0;
    var isURL = '/api/isfile';
    var filePath = '';
    var uploadURL = "/api/uploadfile";

    if (f.length > sceneNameLength) {
        alert("文件名不能超过" + sceneNameLength + "个字符", 'warning');
        return;
    }
    if (FILEUPLOADPATTEN.test(f)) {
        alert("文件名不能包含(" + FILEUPL_FAIL + "),请重新上传", 'warning')
        return;
    }

    //上传文件资源
    if ($('.sceneUpload .title-p').text() == '上传文件' || queryFileData.type == "上传文件") {
        var leaderid = getLeaderid();
        //在线开发处上传文件资源判断
        if (queryFileData) {
            //当前目录
            filePath = queryFileData.menuNow
        } else return;
        if (UPLOAD_TYPE.indexOf(postf) < 0 && UPLOAD_TYPE.indexOf(postn) < 0) {
            alert('格式错误，请重新上传', 'warning');
            return;
        }
        isURL = '/api/isResource'+(leaderid?'?leaderid='+leaderid:'');
        uploadURL = '/api/uploadResource?dir=' + filePath + "&leaderid=" + leaderid;
        //上传场景资源
    } else if ($('.sceneUpload .title-p').text() == '上传场景') {
        f = filename.substring(0, filename.lastIndexOf('.zip'));
        if (f == '') {
            f = filename.substring(0, filename.lastIndexOf('.tjs'));
            if (f == '') {
                alert("非zip或tjs格式文件不能上传", 'warning');
                return;
            }
        }
        var arr = [];
        if (para) {
            $.each(para.myscenelist, function (i, value) {
                if (value.name == f) {
                    arr.push(value)
                }
            })
        } else {
            $.each(myscenelist, function (i, value) {
                if (value.name == f) {
                    arr.push(value)
                }
            })
        }
        if (arr.length > 0 && !ifOverRide) {
            alert('该场景已存在，请重新选择文件上传', 'warning');
            return;
        }
    }

    $.ajax({
        url: isURL,
        type: 'POST',
        cache: false,
        processData: false,
        contentType: false,
        beforeSend: function (request) {
            if (typeof (queryFileData) !== 'undefined') {
                request.setRequestHeader('resfilename', encodeURI(queryFileData.menuNow + '/' + filename))
            } else {
                // if(!ifOverRide) {
                //     var maxNum=scene_nums||para.scene_nums;
                //     if (maxNum <= myscenelist.length) {
                //         alert("最多保存" + maxNum + "个场景文件", 'warning')
                //         bg_upload_close();
                //         return false;
                //     }
                // }
                request.setRequestHeader('resfilename', encodeURI(resFileName))
            }
            request.setRequestHeader('ifoverride', ifOverRide);
            request.setRequestHeader('filesize', $('.sceneUpload #file')[0].files[0].size)
        },
        success: function (data) {
            if (data.code == '200') {
                $(".son").css("width", "0%");
                $(".parent-dlg").show();
                fd.append('file', $('.sceneUpload #file')[0].files[0]);
                $.ajax({
                    url: uploadURL,
                    type: 'POST',
                    cache: false,
                    data: fd,
                    processData: false,
                    contentType: false,
                    xhr: xhrOnProgress(function (e) {
                        var per = Math.floor(100 * e.loaded / e.total);
                        $(".sceneUpload .son").css("width", per + "%");
                        if (per >= 100) {
                            $(".sceneUpload .parent-dlg").hide();
                        }
                    }),
                    success: function (data) {
                        if (data.code == '200' || data == 'ok') {
                            alert("上传成功", "success")
                            $('.sceneUpload').hide();
                            if (queryFileData.type == "上传文件") {
                                newResourseFileList(data.filename, data.fileurl, queryFileData.self);
                            } else if ($('.sceneUpload .title-p').text() == '上传文件' && $('.files-menu').length == 1) {
                                createFileMenu(filePath);
                                if ($('#list1 li[data-name="' + $('#bfilen').data('nameBefore') + '"]').length >= 1) {
                                    $('#list1 li[data-name="' + $('#bfilen').data('nameBefore') + '"]').remove();
                                }
                                myfilename.resourceDir.push($('#bfilen').data('nameBefore'));
                                addLiFile($('#bfilen').data('nameBefore'), $('#bfilen').data('url'), $('#bfilen').data('version'), $('#bfilen').data('isOpen'), $('#bfilen').data('isPro'), 1, $('#bfilen').data('time'))
                            }
                            if ($('.sceneUpload .title-p').text() == '上传场景') {
                                if ($('.btn-resource').hasClass('active')) {
                                    createMenuScene();
                                } else if (para) {
                                    para.mysceneinit();
                                    CreProductList('/api/scenefiles', '.self_cre');
                                } else {
                                    CreProductList('/api/scenefiles', '.self_cre');
                                }
                            }
                            return;
                        } else {
                            if (data.message) {
                                alert(data.message, 'warning');
                            } else alert(data);
                        }
                    }
                })
            } else {
                alert(data.message, 'warning');
            }
        },
        error: function (error) {
            console.log(error)
        }
    })
}

// 删除场景
function delScene(name, para, type) {
    var swal_con = function () {
        var swal_con_1 = function () {
            $.ajax({
                url: '/api/delscenefile',
                dataType: 'json',
                type: 'POST',
                data: JSON.stringify({
                    file: name,
                    type: type
                }),
                cache: false,
                processData: false,
                contentType: false,
                success: function (result) {
                    if (result.code == 200) {
                        alert('删除成功！', 'success')
                        setTimeout(function () {
                            if (para) {
                                para.mysceneinit();
                            } else {
                                CreProductList('/api/scenefiles', '.self_cre');
                            }
                        }, 500);
                    } else {
                        alert('删除失败！', 'error')
                    }
                }
            })
        };
        newConfirm('确定删除该场景？', ['确定', '取消'], [swal_con_1, swal_can]);
    };
    var swal_can = function () {
        swal_close();
    };
    newConfirm('请确保该场景不在开发中？', ['确定', '取消'], [swal_con, swal_can]);
}
//设置面板
function setPanelModel(element, divName, title, bodyT, ifmove, diamin) {
    if (bodyT != 'keytip' && !isLogin('enter', 'openPanel')) return;
    var prePath = window.location.protocol + "//" + window.location.host;
    if (!element || element.hasClass('con_item')) {
        $('.setting0 .active,.setting1 .active').removeClass('active');
    } else if (element) {
        if (!element.hasClass('active')) {
            element.addClass('active');
            element.siblings().removeClass('active');
            element.siblings().children('span').removeClass('active');
            element.parent().siblings().removeClass('active');
            $('#moveclose-dialog_store,#moveclose-dialog_scene-space').css({
                "right": "326px",
                "top": "0px",
                "left": ""
            });
        } else {
            element.removeClass('active');
            $(divName).html('');
            $('#moveclose-dialog_store,#moveclose-dialog_scene-space').css({
                "right": "0px",
                "top": "0px",
                "left": ""
            });
            return;
        }
    }
    // 场景信息，场景效果
    if(element&&(element.hasClass('btn-cjxx') || element.hasClass('btn-cjxg'))){
        $('.setting0 .active,.setting1 .active').removeClass('active');
        if (!element.hasClass('active')) {
            element.addClass('active');
        }
    }
    
    $(divName + "_store"+',#moveclose-dialog_scene-space').html('');

    if (!diamin) diamin = 29;
    var r = (Math.random().toLocaleString()) * 1000;
    var jpath = prePath + "/guide/dialog/" + bodyT + ".html" + '?n=' + r;
    if (bodyT == 'code' || bodyT == 'code1') jpath = prePath + "/guide/cn/code.html" + '?n=' + r;
    thumbState=true;
    $.ajax({
        type: "GET",
        url: jpath,
        dataType: "html",
        async: false,
        success: function (bodyHtml) {
            $.ajax({
                type: "GET",
                url: prePath + "/guide/dialog/index.html",
                dataType: "html",
                async: false,
                success: function (data) {
                    if(bodyT == 'lightInfo'){
                        try {
                            if(!document.getElementById('ifId')){
                                $('.btn-cjxg.btn').removeClass('active');
                                newAlert('设置场景效果需显示3D！','warning');
                                return;
                            }
                        } catch (error) {}
                    }
                    $(divName).html(data);
                    $(divName + ' .panelTitle').text(title);
                    if (title == '园区' || title == '粒子') $(divName + ' .panelIcon .icon-large').show();
                    if (title == '地图' || title == '图表'){
                        $(divName + ' .panelIcon .icon-xinxi').css('display','block');
                    }else{
                        $(divName + ' .panelIcon .icon-xinxi').css('display','none');
                    }
                    $(divName + ' .panelIcon .icon-large').data('type', title);
                    if (bodyT == 'code1') {
                        bodyHtml = bodyHtml.replace('#content_section', '#content_section1');
                        bodyHtml = bodyHtml.replace('#web-context-menu-0', '#web-context-menu-1');
                    }
                    // 插入官方及个人分类
                    insertType();
                    $('#moveclose-dialog .panelModel .panelBody').html(bodyHtml);
                    if (element) {
                        $(divName + ' .panelHeader .close').on('click', function () {
                            element.removeClass('active');
                        })
                    }
                    if (ifmove) {
                        move($(divName), diamin);
                        if (bodyT == 'code' && getCookie("debugSwitch") == 0) {
                            $('#moveclose-dialog').css({
                                "right": "350px",
                                "top": "0px",
                                "left": ""
                            });
                        } else {
                            $('#moveclose-dialog').css({
                                "right": "0px",
                                "top": "0px",
                                "left": ""
                            });
                        }
                    }
                    $('#moveclose-dialog .panelModel').slideDown();
                }
            })
        }
    })
}
//设置面板
function setPanelModel_1(element, divName, title, bodyT, ifmove, diamin) {
    $(divName + " .thumb").removeClass("thumbHover");
    if (bodyT != 'keytip' && !isLogin('enter', 'openPanel')) return;
    var prePath = window.location.protocol + "//" + window.location.host;
    if (!element || element.hasClass('con_item')) {
        $(`${divName} .setting0 .active,${divName} .setting1 .active`).removeClass('active');
    } else if (element) {
        // console.log(element)
        // console.log($('#moveclose-dialog_store .panelModelBody').children().length)
        if($('#moveclose-dialog_store .panelModelBody').children().length) {
            $('#moveclose-dialog_store .panelModelBody').html('');
            if(title == "空间统计") return;
        }
        if($('#moveclose-dialog_scene-space .panelModelBody').children().length) {
            $('#moveclose-dialog_scene-space .panelModelBody').html('');
            if(title == "私有数量") return;
        }
    }
    if (!diamin) diamin = 29;
    var r = (Math.random().toLocaleString()) * 1000;
    var jpath = prePath + "/guide/dialog/" + bodyT + ".html" + '?n=' + r;
    storeThumbState=true;
    $.ajax({
        type: "GET",
        url: jpath,
        dataType: "html",
        async: false,
        success: function (bodyHtml) {
            $.ajax({
                type: "GET",
                url: prePath + "/guide/dialog/index.html",
                dataType: "html",
                async: false,
                success: function (data) {
                    $(divName).html(data);
                    $(`${divName} .panelTitle`).text(title);
                    $(`${divName} .panelIcon .icon-large`).data('type', title);

                    if (bodyT == 'code1') {
                        bodyHtml = bodyHtml.replace('#content_section', '#content_section1');
                        bodyHtml = bodyHtml.replace('#web-context-menu-0', '#web-context-menu-1');
                    }
                    $(`${divName} .panelBody`).html(bodyHtml);
                    if (element) {
                        $(`${divName} .panelHeader .close`).on('click', function () {
                            element.removeClass('active');
                        })
                    }
                    var movecloseDialog = $("#moveclose-dialog .panelModel").css("display");
                    var right = 0;
                    if (movecloseDialog == "block") {
                        right = $("#moveclose-dialog .panelModel").width() + 1;
                    }
                    if (ifmove) {
                        move($(divName), diamin);
                        if (bodyT == 'code' && getCookie("debugSwitch") == 0) {
                            $(divName).css({
                                "right": right + "px",
                                "top": "0px",
                                "left": ""
                            });
                        } else {
                            $(divName).css({
                                "right": right + "px",
                                "top": "0px",
                                "left": ""
                            });
                        }
                    }
                    $(`${divName} .panelModel`).slideDown();
                }
            })
        }
    })
}

// 读取场景数和js应用数限制
function getMaxNum() {
    $('.vip.svip').removeClass('svip');
    $('.user_msg .m-avataruploader-imagewrapper.svip').removeClass('svip');
    $('#headimg.svip').removeClass('svip');
    $('.user_msg .m-avataruploader-imagewrapper.bordervip').removeClass('bordervip');
    $('#headimg.bordervip').removeClass('bordervip');
    $.ajax({
        type: "GET",
        url: "/api/User_info",
        dataType: "json",
        async: false,
        success: function (data) {
            js_nums = data.js_nums;
            scene_nums = data.scene_nums;
            if(data.permission == 'developer') {
                $('.user_msg .m-avataruploader-imagewrapper').addClass('bordervip');
                $('#headimg').addClass('bordervip');
                $('#headimgs').addClass('bordervip');
            }
            if(data.isVipPro) {
                $('.vip').addClass('svip');
                $('.user_msg .m-avataruploader-imagewrapper').addClass('svip');
                $('#headimg').addClass('svip');
                $('#headimgs').addClass('svip');
            }
            
        }
    })
}
// popUpWindow();
//   // 弹出通知
// function popUpWindow() {
//     var url=(location.origin.indexOf('test-thingjs.3dlink.cn')!=-1)?'http://test-thingjs.3dlink.cn':'https://www.thingjs.com';
//     if(location.search.indexOf('?m=sample')!=-1) return;
//     if(location.pathname=='/user/' || location.pathname=='/admin/') return;
//     // if(getCookie('popUp')==false||getCookie('popUp')=='false') return;
//     $.ajax({
//         url: url+'/guide/html/popUp.html?n=' + Math.ceil(Math.random() * 1000),
//         dataType: 'html',
//         success: function (htmlData) {
//             setCookie('popUp', true);
//             $("body").append($(htmlData));
//         }
//     })
// }
// 生成代码块
function CreateCode(t, v, n, onOff, version) {
    if (isLoginOther) {
        loginOutTime();
    }
    if (!isLogin('enter', 'createCode')) return;
    if (window.location.pathname == '/admin/') {
        if (v == undefined) {
            var ref = 'i=0';
        } else if (v == 1) {
            var ref = 'c=' + n;
        } else if ($(t).parents(".self_cre").length) {
            var ref = 'i=' + v + '&sky=' + n;
        } else {
            var ref = 'i=' + v;
        }
        window.location.href = window.location.origin + "/guide/?m=sample&" + ref;
    } else {
        buildNew(t, v, n, onOff, version);
        // buildNew(t, v, n);
    }
}
// 新建项目合并
var signIsShowed = false;
function createSignProject(type,_this) {
    if(PERMISSIONCONFIG.getPermission('创建标记项目')||PERMISSIONCONFIG.getPermission('ThingXPluginOnline')||PERMISSIONCONFIG.getPermission('api内测')){
        var openid = getCookie('openid', true),sso_token = getCookie('sso_token', true),_token=getCookie('token', true);
        if (!(openid&&sso_token&&_token)) {
            loginwindowon();
            return;
        }
        if (($('.filen-active .filen-edit').length > 0)&&!$('.filen-active .filen-edit').is(':hidden')) {
            newAlert('请先保存文件', 'warning');
            return;
        } else if (!(!($('.setting2 li #bfilen').is(':visible')))) {
            if (!($('.filen').is(':visible') && $('#bfilen').data('nameBefore').length > 0 && $('.filen-active .filen-edit').is(':hidden') || $('.filen').is(':visible') && $('#bfilen').data('nameBefore').length > 0 && $('.filen-active').hasClass('reference_li'))) {
                newAlert('新建项目尚未保存', 'warning');
                return;
            }
        }
        // if (PERMISSIONCONFIG.getPermission('创建标记项目')) {
            // if (signIsShowed && signIsShowed == true) {
            //     $(".bg-upload").show();
            //     $('.createTag').show();
            //     $(".ConfirmationPop-up").hide();
            //     $(".bg-upload2").hide();
            // } else {
        if($('.createTag')){
            $('.createTag').remove();
        }
        $.ajax({
            type: "GET",
            url: path + "/guide/dialog/signProject.html?n=" + Math.ceil(Math.random() * 1000),
            dataType: "html",
            async: false,
            success: function (bodyHtml) {
                signIsShowed = true;
                signHtml = bodyHtml;
                $(".bg-upload").show();
                // $("body").append($(bodyHtml)).show();
                $("body").append($(bodyHtml));
            }
        })
        if(type && type == 'decor') {
            // changeProject(null,type);
            $('#sign_project.p_title').trigger('click');
            $('#sign_project.p_title').addClass('active');
            $('.project.tag_item .sign').css('display','block');
            createNewSign('pointDataBox',$('.species.sign_point'),null,'decor');
        }
            // }
        // } else {
        //     newAlert('您暂无权限进行此操作', 'warning');
        // }
        // --------04-03之前注释掉的
        // $.ajax({
        //     url: path + '/api/hasRole',
        //     type: 'post',
        //     dataType: 'json',
        //     data: {
        //         mmdId: mmdId,
        //         roleName: '创建标记项目'
        //     },
        //     success: function (data) {
        //         if (data && data.success) {
        //             console.log(data.success);
        //             if (signIsShowed && signIsShowed == true) {
        //                 $(".bg-upload").show();
        //                 $('.createTag').show();
        //                 $(".ConfirmationPop-up").hide();
        //                 $(".bg-upload2").hide();
        //             } else {
        //                 $.ajax({
        //                     type: "GET",
        //                     url: path + "/guide/dialog/signProject.html",
        //                     dataType: "html",
        //                     async: false,
        //                     success: function (bodyHtml) {
        //                         signIsShowed = true;
        //                         signHtml = bodyHtml;
        //                         $(".bg-upload").show();
        //                         $("body").append($(bodyHtml)).show();
        //                     }
        //                 })
        //             }
        //         } else {
        //             newAlert('您暂无权限进行此操作', 'warning');
        //         }
        //     },
        //     error: function (err) {
        //         console.log(err)
        //     },
        // })
    } else {
        if(_this){
            CreateCode(_this);
        } else {
            CreateCode();
        }
    }
}
// 新建项目
function buildNew(t, v, n, onOff, version) {
    if (!$('.filen-active .filen-edit').is(':hidden')) {
        newAlert('请先保存文件', 'warning');
        return;
    } else if (!(!($('.setting2 li #bfilen').is(':visible')))) {
        if (!($('.filen').is(':visible') && $('#bfilen').data('nameBefore').length > 0 && $('.filen-active .filen-edit').is(':hidden') || $('.filen').is(':visible') && $('#bfilen').data('nameBefore').length > 0 && $('.filen-active').hasClass('reference_li'))) {
            newAlert('新建项目尚未保存', 'warning');
            return;
        }
    }
    if ($('.filen-active .filen-edit').is(":visible") && !onOff) {
        // ifLeaveThisPage($(t));
        newProject(t, v, n);
        return;
    }
    $('#bfilen').text('Untitled.js').attr('type', 'new');
    if(version == 'thingjs2.0'){
        $('.filen #bfilen').attr('data-edition', '2.0');
    }else {
        $('.filen #bfilen').attr('data-edition', '1.0');
    }
    if (getQueryString('m') !== 'sample_old') setUrl(null, []);
    monacoModel.setValue('');
    monaco.editor.setModelLanguage(monacoModel, 'javascript');
    if (v == undefined) {
        monacoModel.setValue('');
    } else if (v && v == 1) {
        var url = '../../../demos/' + n + '/js/' + n + '.js';
        $.ajax({
            url: url,
            type: 'get',
            dataType: 'text',
            async: false,
            success: function (data) {
                monacoModel.setValue(data);
            }
        })
        //monacoModel.setValue('');
    } else if (v && v == 2) {
        var latestVersion = getLatestUearthVersion();
        app_code = `var app = new THING.App();
// 设置app背景为黑色
app.background = [0, 0, 0];
// 引用地图组件脚本
THING.Utils.dynamicLoad(["https://www.thingjs.com/uearth/history/` + latestVersion + `"], function () {
    app.create({
        type: "Map",
        url: "https://www.thingjs.com/citybuilder_console/` + n + `",
        complete: function (event) {
            console.log(event.object.userLayers.length);
        }
    });
});`
        monacoModel.setValue(app_code);
    } else {
        app_code = '\/\/加载场景代码\nvar app = new THING.App({ \n    \/\/ 场景地址\n    "url": "' +
            encodeURI(v) + '",\n    \/\/背景设置\n    "skyBox" :"' + n + '"\n});';
        monacoModel.setValue(app_code);
    }
    $('.filen').show();
    if ($('#bfilen').attr('type') != 'new') $('.filen-active .filen-edit').show();
    $('#gf').hide();
    $('.lifile').removeClass('active');
    $('.lifile .pro_main.main_file').removeClass('main_file');
    $('.setting2 .filen-close').remove();
    $('.wrapper-sam .content .editor').css({
        'height': 'calc(100% - 96px)',
        'top': '60px'
    });
    $('.wrapper-sam .content .content-middle .editor-setting').css({
        'height': '60px'
    });
    $('.filen').addClass('filen-active');
    closeMyFile();
    namebefore = '';
    clearInterval(setId);
    autosave();
    pannelClose();
    tab_change(1);
    reloadIframe();
    moveLiFile();
    typeinit('new');
}
// 跳转至在线搭建
function jumpcb(type, param) {
    if ($.cookie("token") == '' || $.cookie("token") == undefined) {
        loginwindowon();
        return;
    } else {
        if (type) {
            var openurl=window.location.origin + '/cb/'+param;
        } else {
            var openurl=window.location.origin + '/cb';
        }
        var f1=function(){
            window.open(openurl);
            swal_close();
        };
        newConfirm('是否确认通过CampusBuilder Online编辑器创建场景？<br/><br/><div>注：通过CampusBuilder Online编辑器创建场景，不会改变手动上传和自动同步的场景</div>', ['确认', '取消'], [f1, swal_close]);
       
    }

}
// 日期比较
function datedaxiao(t1, t2) {
    var strs1 = new Array(); //定义一数组
    strs1 = t1.split("-"); //字符分割
    var strs2 = new Array(); //定义一数组
    strs2 = t2.split("-"); //字符分割
    if (strs1[0] > strs2[0]) {
        return false;
    } else if (strs1[0] < strs2[0]) {
        return true;
    }
    if (strs1[1] > strs2[1]) {
        return false;
    } else if (strs1[1] < strs2[1]) {
        return true;
    }
    if (strs1[2] > strs2[2]) {
        return false;
    } else if (strs1[2] < strs2[2]) {
        return true;
    }
    return true;
}

//埋点
function _hmt_maidian(a, b, c) {
    var addrIf = window.location.host;
    if (addrIf == '127.0.0.1') return;
    _hmt.push(['_trackEvent', a, b, c]);
}
var storage = window.localStorage;
var flag = storage.flag;

/* 获取用户名信息 */
function getUserInfo() {
    var data = {};
    var token = 'Bearer ' + getCookie('accessToken');
    var f = getCookie('accessToken');
    // console.log(f)
    if (f == null) {
        return;
    } else {
        $.ajax({
            url: 'https://www.thingjs.com/uinapi/user/loginUserInfo',
            type: 'get',
            dataType: 'json',
            async: false,
            headers: {
                'Authorization': token
            },
            success: function (res) {
                //console.log(res.data);
                if (res.status == '0') {
                    data = res.data;

                }
            },error:function(e) {
                if(e.status==401) {
                    clearAllCookie();
                    loginwindowon();
                    return;
                }
            }
        });
        return data;
    }


}

// 判断是否为登陆状态
async function isLogin(type, openType) {
    var loginState=await SSOLOGIN.refresh();
    // console.log(loginState)
    // console.log("判断是否为登陆状态");
    if(loginState=='fail') {
        // console.log('fail');
    }
    var _baseReq='/api/User_info';
    if (getQueryString&&getQueryString('m') == 'sample') _baseReq='/api/sample/User_info';
    var code = getQueryString('code');
    var timestamp = getQueryString('timestamp');
    if(location.pathname!="/user/"){
        $('.vip.svip').removeClass('svip');
        $('.user_msg .m-avataruploader-imagewrapper.svip').removeClass('svip');
        $('#headimg').removeClass('svip');
    }
    var openArr = ['openPanel', 'newOneFile', 'updataPro', 'showreleaseProject', 'loadIframe'];
    // console.log(type,openType)
    if (getCookie('role') == 'admin' || getCookie('role') == 'operation') return;
    var login;
    var uname = getUserName('name');
    if (type) {
        sampleType = type;
    } else {
        sampleType = '';
    }
    if (!uname) {
        clearAllCookie();
        if (type && !code && !timestamp) loginwindowon();
        return false;
    }
    if (!getCookie('token')) {
        clearAllCookie();
        if (type && !code && !timestamp) loginwindowon();
        return false;
    }
    var time = new Date().Format('yyyy-MM-dd');
    if (loginTime && loginTime != time) {
        clearAllCookie();
        if (type) loginwindowon();
        return false;
    }
    if(type=='change'&&!IFSHOWLOGIN) return true;
    if (type && type !== 'tab_change') {
        if (isLoginOther) {
            if (getQueryString('m') == 'sample') {
                if (!isALert || openArr.indexOf(openType) != -1 || type == 'save') {
                    loginOutTime();
                }
            } else {
                loginOutTime();
            }
        } else if (getQueryString('m') == 'sample') {
            if (!isLoginOther) {
                if (type == 'load' || type == 'change' || type == 'save' || openType && type) {
                    $.ajax({
                        url: SERVERPATH + _baseReq,
                        type: "GET",
                        processData: false,
                        contentType: false,
                        async: false,
                        success: function (result) {
                            if (result == '用户不存在') {
                                console.log(result);
                                IFSHOWLOGIN=true;
                            } else {
                                CLIENTID=result.client_id||'';
                                setCookie("client_id", CLIENTID);
                                setCookie("role", result.permission);
                                if(result.client_id&&result.client_id=='rootcloud') {
                                    $('.setting1_1').children().not('.btn-mx,.btn-yq,.btn-city').remove();
                                }
                                if(result.permission == "developer"){
                                    $('.user_msg .m-avataruploader-imagewrapper').addClass('bordervip');
                                    $('#headimg').addClass('bordervip');
                                    $('#headimgs').addClass('bordervip');
                                }
                                if(result.isVipPro) {
                                    $('.vip').addClass('svip');
                                    $('.user_msg .m-avataruploader-imagewrapper').addClass('svip');
                                    $('#headimg').addClass('svip');
                                    $('#headimgs').addClass('svip');
                                }
                                if (new Date(result.lastlogin).Format('yyyy-MM-dd') == time && result.permission == getCookie('role')) {
                                    if (result.token != getCookie('token')) {
                                        setCookie('token',result.token);
                                        IFSHOWLOGIN=true;
                                        if(getQueryString('m') == 'sample') {
                                            isLoginOther = false;
                                            loginOutTime(1);
                                            isALert = false;
                                            IFSHOWLOGIN=false;
                                        } else {
                                            loginOutTime();
                                            isLoginOther = true;
                                        }
                                    } else {
                                        isLoginOther = false;
                                        loginOutTime(1);
                                        isALert = false;
                                        IFSHOWLOGIN=false;
                                    }
                                } else {
                                    clearAllCookie();
                                    newAlert('登录已过期，请重新登录！', 'error');
                                    login = false;
                                    IFSHOWLOGIN=true;
                                }
                            }
                        },
                        error: function (result) {
                            console.log(result);
                            IFSHOWLOGIN=true;
                        }
                    });
                }
            }
        }
        return true;
    }
    $.ajax({
        url: SERVERPATH + _baseReq,
        type: "GET",
        processData: false,
        contentType: false,
        async: false,
        success: function (result) {
            if (result == '用户不存在') {
                clearAllCookie();
                loginwindowon();
                login = false;
            } else {
                CLIENTID=result.client_id||'';
                setCookie("client_id", CLIENTID);
                setCookie("role", result.permission);
                if(result.client_id&&result.client_id=='rootcloud') {
                    $('.setting1_1').children().not('.btn-mx,.btn-yq,.btn-city').remove();
                }
                if(result.permission == "developer"){
                    $('.user_msg .m-avataruploader-imagewrapper').addClass('bordervip');
                    $('#headimg').addClass('bordervip');
                    $('#headimgs').addClass('bordervip');
                }
                if(result.isVipPro) {
                    $('.vip').addClass('svip');
                    $('.user_msg .m-avataruploader-imagewrapper').addClass('svip');
                    $('#headimg').addClass('svip');
                    $('#headimgs').addClass('svip');
                }
                
                if (new Date(result.lastlogin).Format('yyyy-MM-dd') == time && result.permission == getCookie('role')) {
                    if (result.token != getCookie('token')) {
                        IFSHOWLOGIN=true;
                        loginTime = time;
                        isLoginOther = true;
                        setCookie('token',result.token);
                        if (getQueryString('m') == 'sample' && !isALert) {
                            // loginOutTime();
                            // isALert=true;
                        } else if (getQueryString('m') != 'sample') {
                            loginOutTime();
                        }
                    } else {
                        isLoginOther = false;
                        isALert = false;
                        IFSHOWLOGIN=false;
                    }
                    jsnums = result.js_nums;
                    login = true;
                    loginTime = time;

                } else {
                    clearAllCookie();
                    newAlert('登录已过期，请重新登录！', 'error');
                    login = false;
                    IFSHOWLOGIN=true;
                }
            }
        },
        error: function (result) {
            console.log(result);
            clearAllCookie();
            loginwindowon();
            login = false;
            IFSHOWLOGIN=true;
        }
    });
    return login;
}
// 检查用户是否登陆-全景图
function returnPano() {
    if ($.cookie("token") == '' || $.cookie("token") == undefined) {
        loginwindowon();
        return;
    } else {
        window.open(window.location.origin + '/guide/?m=sample', '园区-全景图');
        //    window.location.href=window.location.origin+'/'+'admin/#/myScene?m=pano';
    }
}
// 获取3dMax上传的模型
function get3dMaxModel(keyword, stypeName, target, i, id, server, bigType) {
    var storage = window.localStorage;
    var loadSwitch = true;
    var mmdId = getCookie('mmdId');
    // var mmdId='13252';
    var keyword = ('' || keyword).trim();
    var MyModel = [];
    var arr = [];
    if (storage && storage[mmdId]) {
        personalModel = JSON.parse(storage[mmdId]);
        loadSwitch = false;
        loadModelList(stypeName, target, i, id, server, bigType, personalModel);
    }
    if (mmdId) {
        getPersonBuyModels(mmdId, keyword).then((res) => {
            if ($.cookie('role') == 'developer') getSketchModelsForUser(mmdId, keyword)
        }).then((res1)=>{
            getPersonOBJ(mmdId, keyword)
        }).then((res2)=>{
            $.ajax({
                url: MaxUrl + '/model/getMylibJSON3/' + mmdId + '?keyWord=' + (keyword?encodeURI(encodeURI(keyword)):''),
                type: 'get',
                dataType: "json",
                async: true,
                success: function (data) {
                    var newarr = data.custom;
                    var SELID;
                    var item1 = newarr.find(({
                        id
                    }) => -1 === id);
                    var item2 = newarr.find(({
                        id,
                        title
                    }) => {
                        if (title == '已上传的模型' && id != -1) {
                            SELID = id;
                        }
                    });
                    var item = [];
                    if (item1) {
                        item = item1.children;
                    }
                    if (item2) {
                        item = item.concat(item2.children);
                    }
                    MyModel = newarr.filter(v => {
                        if (Modelfilter.indexOf(v.title) >= 0 && v.id != SELID) {
                            if (v.id == 0) v.children = BuyModel;
                            if (v.id == -1) v.children = item;
                            if (v.id == -5) v.children = ObjModel;
                            if (Array.isArray(v.children)) {
                                v.children.forEach(val => {
                                    val.model_id = val.id;
                                    val.userId = mmdId;
                                    if (v.id == -5) {
                                        val.isOBJ = true;
                                        val.image = val.image ? val.image : path + '/guide/image/loadFailed.png';
                                        val.url = val.url;
                                    } else {
                                        val.is3dMax = true;
                                    }
                                    val.parentId = v.id;
                                    val.parentTitle = v.title;
                                    val.createTime = new Date(val.createTime).getTime();
                                    val.PER = true;
                                })
                            }
                        }
                        return Modelfilter.indexOf(v.title) >= 0 && v.id != SELID
                    });
    
                    MyModel.forEach(v => {
                        if (Array.isArray(v.children)) {
                            v.children = v.children.filter((index) => {
                                if (v.title != '已上传的模型' || (v.title == '已上传的模型' && index.source != 'third')) {
                                    return index.editStatus !== 3;
                                }
                            });
                            arr = arr.concat(v.children);
                        }
                    });
                    if ($.cookie('role') == 'developer') {
                        sketchfabModel.forEach(v => {
                            v.isSketchfab = true;
                            v.PER = true;
                            v.title = v.modelName;
                            v.parentId = 'sketchfab';
                            v.parentTitle = 'Skfb';
                            v.createTime = new Date(v.createTime).getTime();
                            var imgUrl = v.image;
                            if (imgUrl == null || typeof (imgUrl) == 'string' && imgUrl.indexOf('media.sketchfab.com') > -1) {
                                v.image = 'https://store.thingjs.com/thumbnail/' + v.modelId + '.jpeg'
                            }
                            arr.push(v);
                        })
                        MyModel.push({
                            children: [],
                            id: 'sketchfab',
                            title: 'Skfb',
                            type: 'Skfb'
                        });
                    }
                    arr.sort(sortTime);
                    personalModel = {
                        list: MyModel,
                        arr: arr,
                        skLen: sketchfabModel.length
                    }
                    if (loadSwitch) {
                        loadModelList(stypeName, target, i, id, server, bigType, personalModel);
                    }
                    if(keyword == '' || keyword == undefined || keyword == null){
                        storage.setItem(mmdId, JSON.stringify(personalModel));
                    }
                },
                error: function (data) {
                    console.log(data);
                    personalModel = {
                        list: [],
                        arr: [],
                        skLen: 0
                    }
                    if(keyword == '' || keyword == undefined || keyword == null){
                        storage.setItem(mmdId, JSON.stringify(personalModel));
                    }
                }
            })
        })
    } else {
        loadModelList(stypeName, target, i, id, server, bigType, {
            list: MyModel,
            arr: arr
        })
    }

    return {
        list: MyModel,
        arr: arr
    };
}
// 获取所有个人模型记录（不生成列表）
function getAllPerson(keyword) {
    var storage = window.localStorage;
    var mmdId = getCookie('mmdId');
    // var mmdId='13252';
    var MyModel = [];
    var arr = [];
    if (storage && storage[mmdId]) {
        personalModel = JSON.parse(storage[mmdId]);
    }
    getPersonOBJ(mmdId,keyword).then((res)=>{
        getPersonBuyModels(mmdId,keyword)
    }).then((res1)=>{
        if (mmdId) {
            if ($.cookie('role') == 'developer') getSketchModelsForUser(mmdId, keyword);
        }
    }).then((res2)=>{
        if (mmdId) {
            // if ($.cookie('role') == 'developer') getSketchModelsForUser(mmdId, keyword);
            $.ajax({
                url: MaxUrl + '/model/getMylibJSON3/' + mmdId + '?keyWord='  + (keyword?encodeURI(encodeURI(keyword)):''),
                type: 'get',
                dataType: "json",
                async: true,
                success: function (data) {
                    var newarr = data.custom;
                    var SELID;
                    var item1 = newarr.find(({
                        id
                    }) => -1 === id);
                    var item2 = newarr.find(({
                        id,
                        title
                    }) => {
                        if (title == '已上传的模型' && id != -1) {
                            SELID = id;
                        }
                    });
                    var item = [];
                    if (item1) {
                        item = item1.children;
                    }
                    if (item2) {
                        item = item.concat(item2.children);
                    }
                    MyModel = newarr.filter(v => {
                        if (Modelfilter.indexOf(v.title) >= 0 && v.id != SELID) {
                            if (v.id == 0) v.children = BuyModel;
                            if (v.id == -1) v.children = item;
                            if (v.id == -5) v.children = ObjModel;
                            if (Array.isArray(v.children)) {
                                v.children.forEach(val => {
                                    val.model_id = val.id;
                                    val.userId = mmdId;
                                    if (v.id == -5) {
                                        val.isOBJ = true;
                                        val.image = val.image ? val.image : path + '/guide/image/loadFailed.png';
                                    } else {
                                        val.is3dMax = true;
                                    }
                                    val.parentId = v.id;
                                    val.parentTitle = v.title;
                                    val.PER = true;
                                    val.createTime = new Date(val.createTime).getTime();
                                })
                            }
                        }
                        return Modelfilter.indexOf(v.title) >= 0 && v.id != SELID
                    });
                    MyModel.forEach(v => {
                        if (Array.isArray(v.children)) {
                            v.children = v.children.filter((index) => {
                                if (v.title != '已上传的模型' || (v.title == '已上传的模型' && index.source != 'third')) {
                                    return index.editStatus !== 3;
                                }
                            });
                            arr = arr.concat(v.children);
                        }
                    });
                    if ($.cookie('role') == 'developer') {
                        sketchfabModel.forEach(v => {
                            v.isSketchfab = true;
                            v.PER = true;
                            v.title = v.modelName;
                            v.parentId = 'sketchfab';
                            v.parentTitle = 'Skfb';
                            v.createTime = new Date(v.createTime).getTime();
                            var imgUrl = v.image;
                            if (imgUrl == null || typeof (imgUrl) == 'string' && imgUrl.indexOf('media.sketchfab.com') > -1) {
                                v.image = 'https://store.thingjs.com/thumbnail/' + v.modelId + '.jpeg'
                            }
                            arr.push(v);
                        })
                        MyModel.push({
                            children: [],
                            id: 'sketchfab',
                            title: 'Skfb',
                            type: 'Skfb'
                        });
                    }
                    arr.sort(sortTime);
                    personalModel = {
                        list: MyModel,
                        arr: arr,
                        skLen: sketchfabModel.length
                    }
                    if(keyword == '' || keyword == undefined || keyword == null){
                        storage.setItem(mmdId, JSON.stringify(personalModel));
                    }
                },
                error: function (data) {
                    console.log(data);
                    personalModel = {
                        list: [],
                        arr: [],
                        skLen: 0
                    }
                    if(keyword == '' || keyword == undefined || keyword == null){
                        storage.setItem(mmdId, JSON.stringify(personalModel));
                    }   
                }
            })
        }
    })

    return {
        list: MyModel,
        arr: arr,
    };
}
// 加载个人sketchfab
function getSketchModelsForUser(mmdId, keyword) {
    return new Promise(function(resolve, reject){
        var url = ModelServer + '/model/querySketchModelsForUser';
        $.ajax({
            url: url,
            data: {
                uid: mmdId,
                keyWord: keyword
            },
            type: 'get',
            dataType: 'json',
            success: function (data) {
                if (data.state) {
                    sketchfabModel = data.content;
                    resolve(1)
                }
            },
            error: function (err) {
                sketchfabModel = [];
                console.log(err)
            }
        })
    })
}
//主要用于加载个人模型列表
function loadModelList(stypeName, target, i, id, server, bigType, personalModel) {
    modelMsg.smallType = '';
    queryData.smallType = '';
    queryData.bigType = 'personal';
    modelMsg.bigType = '个人';
    if ($.cookie('id') == null) {
        loginwindowon();
        $('.loadingModel').hide();
        $('.noModelTip').hide();
    } else {

        if ($(target).hasClass("checkbigtype")) {
            $('.big-variety-ul li.checkbigtype').not(target).removeClass("checkbigtype")
            // $(target).removeClass("checkbigtype");
            // $('.small-variety-ul').html("");
            // $('.variety').hide();
            // userId='';
            // format='';
            // queryData.smallType = '';
            // queryData.bigType = '';
            // modelMsg.bigType = '';
            $('.small-variety-ul').find('.checksmalltype').removeClass("checksmalltype");
        } else if (bigType != '') {
            $('.big-variety-ul li.checkbigtype').not(target).removeClass("checkbigtype")
            $(target).addClass("checkbigtype");
            $('.small-variety-ul').html('');
            try { 
                if(personalModel.list.length) {
                    [personalModel.list[0], personalModel.list[1], personalModel.list[2]] = [personalModel.list[1], personalModel.list[2], personalModel.list[0]];
                    try {
                        if(personalModel.list.length==4&&personalModel.list[0].title!=Modelfilter[0]||personalModel.list[1].title!=Modelfilter[2]||personalModel.list[2].title!=Modelfilter[2]||personalModel.list[3].title!=Modelfilter[3]) {
                            var arr=[];
                            Modelfilter.forEach(title=>{
                                var _arr=personalModel.list.filter(v=>{if(v.title==title) return(v);});
                                if(_arr.length) {
                                    arr.push(_arr[0]);
                                }
                            })
                            if(arr.length==4) {
                                personalModel.list=arr;
                            }
                        }
                    } catch (error) {};
                    var small_variety = template('small-variety' + '_3dMax', {
                        list: personalModel.list
                    });
                    $('.small-variety-ul').html(small_variety);
                }
            } catch (error) {
                
            }
        }
        if (bigType == '') {
            queryData.bigType = '';
            modelMsg.bigType = '';
        }
        titleList(modelMsg, server);
    }
}
//加载个人OBJ模型列表
function getPersonOBJ(mmdId, keyword) {
    return new Promise(function(resolve, reject){
        $.ajax({
            // url:'http://39.106.215.250:3000/diyModels/getUserModels',
            url: '/api/getOBJModels',
            data: {
                uid: mmdId,
                keyword: keyword
            },
            type: 'post',
            dataType: 'json',
            success: function (data) {
                if (data.code == 200) {
                    ObjModel = data.content ? data.content : [];
                    resolve(3)
                }else {
                    ObjModel = [];
                }
            },
            error: function (err) {
                console.log(err)
                ObjModel=[];
            }
        })
    })
}
//加载个人已购买模型列表
function getPersonBuyModels(mmdId, keyword) {
    return new Promise(function(resolve, reject){
        $.ajax({
            url: '/api/getBuyModels',
            data: {
                userid: mmdId,
                keyWord: keyword||''
            },
            type: 'post',
            dataType: 'json',
            success: function (data) {
                if (data.code == 200) {
                    BuyModel = data.content;
                    resolve(2)
                }else {
                    BuyModel = [];
                }
            },
            error: function (err) {
                console.log(err)
                BuyModel=[];
            }
        })
    })
}
function sortTime(x, y) {
    var prevTime = new Date(x.updateTime || x.createTime).getTime() ? new Date(x.updateTime || x.createTime).getTime() : 0;
    var nextTime = new Date(y.updateTime || y.createTime).getTime() ? new Date(y.updateTime || y.createTime).getTime() : 0;
    return -(prevTime - nextTime);
}
// 数组拆分
split_array = (arr, len) => {
    let arr_length = arr.length;
    let newArr = [];
    for (let i = 0; i < arr_length; i += len) {
        newArr.push(arr.slice(i, i + len));
    }
    return newArr;
}

function showUploadPanel(type, para,option) {
    if(!getCookie('openid')&&!getCookie('mmdId')) {
        clearAllCookie();
        loginwindowon();
        return false;
    }
    fetch('/api/checkUser/role?openid='+encodeURIComponent(getCookie('openid'))).then(res=>res.json()).then(res=>{
       if(res&&res.code==200&&res.content&&res.content.role) {            
            $.ajax({
                type: "GET",
                url: path + "/guide/dialog/upload.html?n="+Math.ceil(Math.random()*1000),
                dataType: "html",
                async: false,
                success: function (bodyHtml) {
                    $(".bg-upload").html(bodyHtml);
                    sceneupload(type, para,res.content.role,option)
                }
            })
       } else {
        console.log(res)
       }
    }).catch(e=>{
        console.log(e)
    })
}



function showShareProjectPanel(name, url, para, ifSample) {
    $.ajax({
        type: "GET",
        url: path + "/guide/dialog/shareProject.html",
        dataType: "html",
        async: false,
        success: function (bodyHtml) {
            $(".shareProject").html(bodyHtml);
            initShare(name, url, para, ifSample);
        }
    })
}

function showOrganizeProjectPanel(organizProPath) {
    $.ajax({
        type: "GET",
        url: path + "/guide/dialog/organizeProject.html",
        dataType: "html",
        async: false,
        success: function (bodyHtml) {
            $(".organizeProject").html(bodyHtml);
            initMemberList(organizProPath);
        }
    })
}
//弹窗提示
function closeAlert() {
    $(".alert_tip_box").remove();
}

function alertTip(content, type) {
    if (type == 'info') type = 'warning';
    var html = '<div class="alert_tip_box" style="z-index:1000000"> \
        <div class="alert_tip_container">\
            <div class="alert_tip_title" >\
                <span class="pc-head">温馨提示</span>\
                <span class="alert_close" onclick="closeAlert();"><i class="iconfont icon-close"></i></span>\
            </div>\
            <div class="alert_tip_content">\
                <img class="info_img" src="/guide/image/icons/' + type + '.png" alt="">\
                <span class="info_text">' + content + '</span>\
            </div>\
            <div class="footer_box">\
                <span class="active_btn" onclick="closeAlert()">确定</span>\
            </div>\
        </div> \
    </div>'
    $("body").append(html);
}

// 弹出窗新样式
function newAlert(msg, type, title, fn, time, timeout, shari) { 
    if(!shari){
        try{
            if($(msg).length) if($(msg).text().split('').pop() != '！') msg += '！';
        } catch (e) {
            if (msg.split('').pop() != '！') msg += '！'
        } 
    }
    /* msg 提示信息   type 提示类型   title 提示头部信息   fn 回调函数   time 设置计时器自动关闭（'false')   timeout 刷新用户项目表 */
    if (type == undefined) {
        type = 'info'
    }
    if (timeout) {
        sampleTimeout = timeout;
    } else {
        sampleTimeout = '';
    }
    // if (msg.split('').pop() != '！') msg += '！';
    var content = setWH(msg, type , null , shari);
    if (type == 'error' && msg == '登录已过期，请重新登录！') {
        SSOLOGIN.logout();
        indexlogininit('logout');
        swal({
            type: type,
            title: title || '温馨提示',
            html: content,
            confirmButtonText: '确定',
            showConfirmButton: true
        }).then(function (value) {
            if (value.value) {
                $('#login').show();
                $('#login').html('登录').attr('data-log', '-1');
                $('.vipLi .login-name').attr('data-log', '-1');
                $('#login').removeClass("login-active");
                $('#nav-reg').show();
                $('#msg').hide();
                $('#emailIcon').hide();
                $('#emailLetter').hide();
                $('#headimg').hide();
                $('.vipLi').hide();
                $(".vip").css({
                    "display": "none"
                });
                $('#developer').hide();
                $('#recharge').hide();
                $('#modelSer').hide();
                $('#develpoment').hide();
                clearAllCookie();
                loginwindowon();
            }
        })
    } else if (type == 'success' && (msg == '修改成功！' || msg == '新建成功！' || msg == '取消占用成功！' || time == 'false')) {
        swal({
            type: type,
            title: title || '温馨提示',
            html: content,
            showConfirmButton: false,
            timer: 1500
        }).then(function (value) {
            if (value) {
                if (fn) fn();
            }
        });
        $('.swal2-container .swal2-close').remove();
    } else {
        swal({
            type: type,
            title: title || '温馨提示',
            html: content,
            confirmButtonText: shari=='shari'?'预览':'确定',
            showConfirmButton: true,
        }).then(function (value) {
            if (value) {
                if(value.dismiss=='close'&&shari=='shari') return swal_close();
                if (fn) fn();
            }
        })
    }
    $('.swal2-container').addClass('newalert');
}

function newInfos(msg,btnArr,fnArr,shari){
    var str='';
    fnArr=fnArr||[];
    for(var i=0;i<btnArr.length;i++) {
        str+="<button class='btn_item"+i+"'>"+btnArr[i]+"</button>";
    }
    var btn=`<div class='footer-btn'>`+str+`</div>`;
    swal({
        title:'项目信息',
        html: setWH1(msg,shari,400),
        showConfirmButton: false,
        footer:btn
    });
    $('.swal2-container').addClass('newalert');
    $('.swal2-footer .footer-btn').on('click','button',function() {
        if(fnArr[$(this).index()]) {
            fnArr[$(this).index()]();
        } else {
            swal_close();
        }
    });
}
function newConfirm(msg, btnArr, fnArr, closeBack, newWidth, type,title) {
    // console.log(getQueryString('m')=='sample'&&$('body .login-window').is(':visible')&&!type)
    // if(getQueryString('m')=='sample'&&$('body .login-window').is(':visible')&&!type) {
    //     return;
    // }
    var str = '';
    fnArr = fnArr || [];
    for (var i = 0; i < btnArr.length; i++) {
        str += "<button class='btn_item" + i + "'>" + btnArr[i] + "</button>";
    }
    var btn = `<div class='footer-btn'>` + str + `</div>`;
    swal({
        type: 'warning',
        title: title||'温馨提示',
        html: setWH(msg, 'confirm', newWidth),
        showConfirmButton: false,
        footer: btn
    }).then(function (value) {
        if (value.dismiss && closeBack) {
            if (fnArr.length) fnArr[fnArr.length - 1]();
        }
    });
    $('.swal2-container').addClass('newalert');
    $('.swal2-footer .footer-btn').on('click', 'button', function () {
        if (fnArr[$(this).index()]) {
            fnArr[$(this).index()]();
        } else {
            swal_close();
        }
    });
}

function swal_close() {
    swal.close();
}

function getStrLength(str) {
    if (str) {
        try{if($(str).length) str=$(str).text();}catch(e) {}
        var r = /[^\x00-\xff]/g;
        return (str.replace(r, "mm").length);
    }
    return 0;
};

function setWH(msg, type, newWidth, shari) {
    var rNum = msg.split('<hr>').length - 1;
    type = type || 'info';
    var strLength = getStrLength(msg) / 65;
    // msg=msg.replace(/[\r\n]/g,'<br>');
    var lineNum = Math.ceil(strLength);
    var width = 520 * (0.618 + 0.1 * (lineNum - 1));
    var newLineNum = Math.ceil(getStrLength(msg) * 14 * 12 / 24 / (width - 60)) + rNum;
    var msgHeight = newLineNum * 20;
    var height = (width + 28) * 0.618 - 134;
    var marginH = (height - msgHeight) / 2 + (newLineNum > 1 ? 1 : -4);
    if(shari !== 'attribute'){
        var typeIcon = `<div class="` + type + `-icon"></div>`;
    }else{
        var typeIcon = `<div class="` + type + `-icon" style = "display: none;"></div>`;
    }
    var msgDiv = `<div class="msg" style='margin-top:` + (newLineNum > 1 && msg.length != 17 ? 0 : 3) + `px'>` + msg + `</div>`;
    if (newWidth) {
        width = newWidth;
    }
    if(shari == 'shari'){
        var content = `<div class='main' style="width:` + 500 + `px;margin:` + 40 + `px auto">` + typeIcon + msgDiv + `</div>`;
    }else if(shari == 'attribute'){
        var content = `<div class='main' style="width:` + 400 + `px;margin:` + 20 + `px auto">` + typeIcon + msgDiv + `</div>`;
    }else{
        var content = `<div class='main' style="width:` + width + `px;margin:` + marginH + `px auto">` + typeIcon + msgDiv + `</div>`;
    }
    return content;
}
function setWH1(msg, type, newWidth, shari) {
    var rNum = msg.split('<hr>').length - 1;
    type = type || 'info';
    var strLength = getStrLength(msg) / 65;
    // msg=msg.replace(/[\r\n]/g,'<br>');
    var lineNum = Math.ceil(strLength);
    var width = 520 * (0.618 + 0.1 * (lineNum - 1));
    var newLineNum = Math.ceil(getStrLength(msg) * 14 * 12 / 24 / (width - 60)) + rNum;
    var msgHeight = newLineNum * 20;
    var height = (width + 28) * 0.618 - 134;
    var marginH = (height - msgHeight) / 2 + (newLineNum > 1 ? 1 : -4);
    if(shari !== 'attribute'){
        var typeIcon = `<div class="` + type + `-icon"></div>`;
    }else{
        var typeIcon = `<div class="` + type + `-icon" style = "display: none;"></div>`;
    }
    var msgDiv = `<div class="msg" style='margin-top:` + (newLineNum > 1 && msg.length != 17 ? 0 : 3) + `px'>` + msg + `</div>`;
    if (newWidth) {
        width = newWidth;
    }
    if(shari == 'shari'){
        var content = `<div class='main' style="width:` + 500 + `px;margin:` + 0 + `px auto">` + typeIcon + msgDiv + `</div>`;
    }else if(shari == 'attribute'){
        var content = `<div class='main' style="width:` + 400 + `px;margin:` + 0 + `px auto">` + typeIcon + msgDiv + `</div>`;
    }else{
        var content = `<div class='main' style="width:` + width + `px;margin:` + 0 + `px auto">` + typeIcon + msgDiv + `</div>`;
    }
    return content;
}
// 字符串截取
String.prototype.sub = function (n) {
    var r = /[^\x00-\xff]/g;
    if (this.replace(r, "mm").length <= n) return this;
    var m = Math.floor(n / 2);
    for (var i = m; i < this.length; i++) {
        if (this.substr(0, i).replace(r, "mm").length >= n) {
            return this.substr(0, i) + "...";
        }
    }
    return this;
};
// 序号转换
function parseStr(n) {
    if (n < 0) {
        return 0;
    } else if (n <= 9) {
        return n;
    } else if (n < 36) {
        return String.fromCharCode(n - 10 + 65);
    } else {
        return String.fromCharCode(n - 36 + 97);
    }
}
// 32进制
function str32ToBit(str) {
    let n = Number(str);
    let bit = '';
    for (let i = 0; i < 4 - n.toString(32).length; i++) {
        bit += '0';
    }
    return bit + n.toString(32);
}

// 场景转码
function parseSecneUrl(url) {
    if (url == '') return '';
    if (url.indexOf(path + '/') == 0) url = url.replace(path + '/', '');
    if (url.indexOf('.') == 0) url = url.replace('.', '');
    // 如果是本地场景 => 加上'/'
    if (url.indexOf('/') !== 0 && url.indexOf('http') !== 0) url = '/' + url;
    var sceneLink = '';
    $.ajax({
        url: '/api/getSceneUrl',
        type: 'post',
        async: false,
        data: {
            preSceneUrl: url,
            type: 'scene'
        },
        success: function (res) {
            if (res.code == 200 && res.sceneLink) {
                sceneLink = res.sceneLink;
            }
        },
        error: function (res) {
            console.log(res);
        }
    })
    if (sceneLink != '') return sceneLink;
    return encodeURI(url.substring(1));
}
// 场景解码
function decodeSceneUrl(url) {
    // var scenePath='';
    var authorID = "";
    $.ajax({
        url: '/api/queryCodeScene?sceneLink=' + url,
        type: 'get',
        async: false,
        success: function (res) {
            if (res.scenePath) {
                // scenePath=path+'/'+res.scenePath;
                authorID = res.mmdId;
            }
        },
        error: function (res) {
            console.log(res);
        }
    })
    return {
        scenePath: url,
        authorID: authorID
    };
}
// 模型转码
function parseModelUrl(url) {
    if (url == '') return '';
    //obj url 合法性判断
    var modelLink = '';
    $.ajax({
        url: '/api/getSceneUrl',
        type: 'post',
        async: false,
        data: {
            preSceneUrl: url,
            type: 'model'
        },
        success: function (res) {
            if (res.code == 200 && res.sceneLink) {
                modelLink = res.sceneLink;
            }
        },
        error: function (res) {
            console.log(res);
        }
    })
    if (modelLink != '') return modelLink;
    return encodeURI(url.substring(1));
}

function getLatestUearthVersion() {
    var latestVersion = 'uearth.min.v1.7.7.2.js';
    $.ajax({
        url: '/uearth/history/index.json',
        type: 'get',
        async: false,
        success: function (data) {
            if (data && data.data && data.data[0]) {
                latestVersion = data.data[0];
            }
        }
    })
    return latestVersion;
}

function coverLogin(swal_con, res) {
    var swal_can = function () {
        swal_close();
    }
    newConfirm(res.message, ['确定', '取消'], [swal_con, swal_can], null, null, 1);
}
var timeOut;
// 30s计时
function loginOutTime(type) {
    // console.log(!isALert&&isLoginOther)
    // if(!isALert&&isLoginOther) {
    //     newAlert('本账号已在另一处登录！平台将对单账号同时登录进行限制！','warning');
    //     isALert=true;
    // }
    return;
    clearInterval(timeOut);
    if (type) {
        window.localStorage.removeItem('LOGINTIMEOUT');
        $('body span.setTimeSpan').remove();
        return;
    }
    if (!isALert) {
        newAlert('本账号已在另一处登录！当前登录会在 30秒后自动退出登录！', 'warning');
        window.localStorage.setItem('LOGINTIMEOUT', 30);
        isALert = true;
    }
    var timeSpan = `<span class='setTimeSpan'></span>`;
    $('body').append($(timeSpan));
    if (window.localStorage.getItem('LOGINTIMEOUT') == undefined || window.localStorage.getItem('LOGINTIMEOUT') == null) {
        window.localStorage.setItem('LOGINTIMEOUT', 10);
    }
    var timeS = Number(window.localStorage.getItem('LOGINTIMEOUT'));
    $('body span.setTimeSpan').html(timeS);
    timeOut = setInterval(function () {
        if (!isLoginOther) {
            return clearInterval(timeOut);
        }
        $('body span.setTimeSpan').html(timeS);
        window.localStorage.setItem('LOGINTIMEOUT', timeS);
        if (timeS > 0) {
            timeS--;
        } else {
            clearInterval(timeOut);
            clearAllCookie();
            indexlogininit('stopCurrentPage');
        }
    }, 1000);
}
// 点击返回顶部
function scrolltosTop(){
    $("#content").on('scroll',function(){
        if ($("#content").scrollTop() >= 100) {
            $("#scrollToTop").show().addClass("scrollToTop");
        } else {
            $("#scrollToTop").hide().removeClass("scrollToTop");
        }
    });
    $('#scrollToTop').click(function () {
        $("#content").stop().animate({scrollTop:0},1000);
    });
}

// 轮播滚动左右按钮
const arrowButton =  {
    initial: 0,
    left: function(itemWidth,$swper){
        // 获取li的宽度
        this.initial = this.initial <= 0 ? 0 : this.initial - itemWidth;
        console.log(this.initial)
        $swper.css('transform',"translateX(-"+this.initial+"px)")
    },
    right: function(numWidth,itemWidth,$swper){
        this.initial = this.initial >= numWidth ? numWidth : this.initial + itemWidth;
        console.log(this.initial)
        $swper.css('transform',"translateX(-"+this.initial+"px)")
    }
}

function newmessage(content,type,location){    
    $("body .message_bg").remove();
    var dom=`<div class='message_bg'><div class="alertMessage">
    <div class="alertMessage-notice">
        <div class="alertMessage-notice-content">
            <div class="alertMessage-notice-content-text">
                <div class="alertMessage-custom-content alertMessage-success">
                    <i class="iconfont icon-wancheng"></i>
                    <span>新增成功</span>
                </div>
            </div>
        </div>
    </div>
    </div></div>`;
    $("body").append($(dom));
    $(".message_bg .alertMessage-custom-content span").text(content);
    if(type=="success"){
        $('.message_bg .alertMessage-custom-content i').addClass("icon-wancheng");
        $('.message_bg .alertMessage-custom-content i').removeClass("icon-error");
        $('.message_bg .alertMessage-custom-content').addClass("alertMessage-success");
        $('.message_bg .alertMessage-custom-content').removeClass("alertMessage-error");
    }else{
        $('.message_bg .alertMessage-custom-content i').addClass("icon-error");
        $('.message_bg .alertMessage-custom-content i').removeClass("icon-wancheng");
        $('.message_bg .alertMessage-custom-content').addClass("alertMessage-error");
        $('.message_bg .alertMessage-custom-content').removeClass("alertMessage-success");
    }
    if(location) {
        var offsetTop = 0,offsetLeft = 0,panelHeight = 0,panmelWidth = 0,panel = '';
        // location  1、工具面板2、云渲染
        if(location == 1){
            panel = $('#moveclose-dialog');
        }else if(location == 2){
            panel = $('#data');
        }else if(location == 3) {
            $(".message_bg .alertMessage").css('top','50%');
            $(".message_bg .alertMessage").css('left', '35%');
        }
        if(panel != '' && location != 3){
            offsetTop = panel.offset().top;
            offsetLeft = panel.offset().left;
            panelHeight = panel.height();
            panmelWidth = panel.width();
            $(".message_bg .alertMessage").css('top',offsetTop+(panelHeight/2)+'px');
            $(".message_bg .alertMessage").css('left',offsetLeft+(panmelWidth/2)-($(".message_bg .alertMessage").width())/2+'px');
        }
    }    
    $(".message_bg .alertMessage").removeClass("alert-Message-hide");
    $(".message_bg .alertMessage").addClass("alert-Message-show");
    $(".message_bg .alertMessage").show();
    $(".message_bg .alertMessage .alertMessage-notice .alertMessage-notice-content").animate({'opacity':'1'},200)
    setTimeout(closemessage,1200);
}
function closemessage(){
    $(".message_bg .alertMessage .alertMessage-notice .alertMessage-notice-content").animate({'opacity':'0'},800)
    setTimeout(function(){
        $(".message_bg .alertMessage").removeClass("alert-Message-show");
        $(".message_bg.alertMessage").addClass("alert-Message-hide");
        $(".message_bg .alertMessage").hide();
        $(".message_bg").remove();
        $(".message_bg.alertMessage").addClass("alert-Message-hide");
    },800)
}
// 调用授权
function uploadCodeFile(type, para, _this, title, getAuth, authPara) {
    if ($('body').children('.uploadCode_bg').length) $('body').children('.uploadCode_bg').remove();
    var url = path + '/guide/dialog/uploadMach.html';
    if (type) url = path + '/guide/dialog/uploadUpdate.html';
    if(type == 2){
        url = path + '/guide/dialog/userOrderAuth.html';
        $.ajax({
            url:'/guide/js/createCodeFileNew.js',
            type: 'get',
            success: function (js) {
                $.ajax({
                    url: url,
                    type: 'get',
                    dataType: 'html',
                    success: function (res) {
                        var html = res;
                        html=html.replace('<script></script>','<script>'+js+'</script>');
                        if(self!=top||!type) {
                            if(_this && _this.isServeDep) {
                                parent.authData=initCodeFile('mach',para, _this, title, getAuth, authPara);
                                $('body').append($(html));
                                return
                            }
                            if($(parent.document.body).find('#deploy_box:visible').length||$(parent.document.body).find('#iframeBody:visible').length) {
                                $(parent.document.body).append($(html));
                                parent.authData=null;
                                if(getAuth&&getAuth=='getAuthMsg'&&authPara) {
                                    parent.authData=parent.initCodeFile('mach',para, _this, title, getAuth, authPara);
                                    return
                                } else {
                                    parent.authData=parent.initCodeFile('mach',para, _this, title, getAuth, authPara);
                                }
                                // parent.initCodePara(para, _this, title);
                                return;
                            }
                        }
                        authData=null;
                        $('body').append($(html));
                        // initCodePara(para, _this, title);
                        authData=initCodeFile('olf',para, _this, title, getAuth, authPara);
                    },error:function(e){
                        console.log(e)
                    }
                })
            },error:function(error){
                console.log(error)
            }
        });
        return
    }
    $.ajax({
        url:'/guide/js/createCodeFile.js',
        type: 'get',
        success: function (js) {
            $.ajax({
                url: url,
                type: 'get',
                dataType: 'html',
                success: function (res) {
                    var html = res;
                    html=html.replace('<script></script>','<script>'+js+'</script>');
                    if(self!=top||!type) {
                        if(_this && _this.isServeDep) {
                            parent.authData=initCodeFile('mach',para, _this, title, getAuth, authPara);
                            $('body').append($(html));
                            return
                        }
                        if($(parent.document.body).find('#deploy_box:visible').length||$(parent.document.body).find('#iframeBody:visible').length) {
                            $(parent.document.body).append($(html));
                            parent.authData=null;
                            if(getAuth&&getAuth=='getAuthMsg'&&authPara) {
                                parent.authData=parent.initCodeFile('mach',para, _this, title, getAuth, authPara);
                                return
                            } else {
                                parent.authData=parent.initCodeFile('mach',para, _this, title, getAuth, authPara);
                            }
                            // parent.initCodePara(para, _this, title);
                            return;
                        }
                    }
                    authData=null;
                    $('body').append($(html));
                    // initCodePara(para, _this, title);
                    authData=initCodeFile('xfer',para, _this, title, getAuth, authPara);
                },error:function(e){
                    console.log(e)
                }
            })
        },error:function(error){
            console.log(error)
        }
    })
}
function copyLicUrl(dom) {
    console.log($(dom).parents('.confirm_url'))
    var UrlI = $(dom).parents('.confirm_url').find('._url input.licUrl');
    // console.log(UrlI)
    UrlI.select(); // 选择对象
    document.execCommand("Copy");$('.confirm_url ._url ._tip').html('复制成功');
}
function resetTip(dom){
    $(dom).find('._tip').html('单击复制');
}
function copyLinks(dom) {
    var e = $(dom).siblings('.share-url-copy');
    console.log(e)
    e.select();
    document.execCommand("Copy");
    newmessage('复制成功','success')
}

function alertMessageShow() {
    $('#alert-message').removeClass('alert-message-hide');
    $('#alert-message').addClass('alert-message-show');
    $('#alert-message').show();
    setTimeout(alertMessageHide, 1200)
}
function alertMessageHide() {
    $("#alert-message").removeClass("alert-message-show");
    $("#alert-message").addClass("alert-message-hide");
    setTimeout(function () {
        $('#alert-message').hide();
    }, 800)
}
function postOcpcTSZ(){
    if(!getQueryString('qhclickid')) return;
    return new Promise((resolve, reject) => {
        $.ajax({
            url:'/api/postOcpcTSZ',
            type:'post',
            data:{'qhclickid': getQueryString('qhclickid')},
            async:true,
            success:function(res) {
                resolve('ok')
            },
            error:function(e) {
                console.log(e);
            }
        })
    })
}
function postOcpcBD(){
    if(!getQueryString('bd_vid')) return;
    return new Promise((resolve, reject) => {
        $.ajax({
            url:'/api/postOcpcBD',
            type:'post',
            data: {'url': location.href},
            async:true,
            success:function(res) {
                resolve('ok')
            },
            error:function(e) {
                console.log(e);
            }
        })
    })
}
function postOcpcZH(){
    if(!getQueryString('cd')) return;
    return new Promise((resolve, reject) => {
        $.ajax({
            url: decodeURIComponent(getQueryString('cd')) + '$event=api_ask$ts=true',
            type:'get',
            async:true,
            success:function(res) {
                resolve('ok')
            },
            error:function(e) {
                console.log(e);
            }
        })
    })
}